# ç¬¬04ç« :è¯·æ±‚å‚æ•°ç»‘å®šä¸æ ¡éªŒ

> **æœ¬ç« å¯¼è¯»**
>
> åœ¨ Web å¼€å‘ä¸­,å‚æ•°æ ¡éªŒæ˜¯ä¿éšœç³»ç»Ÿå®‰å…¨å’Œç¨³å®šæ€§çš„ç¬¬ä¸€é“é˜²çº¿ã€‚æœ¬ç« å°†è¯¦ç»†è®²è§£ Gin æ¡†æ¶çš„å‚æ•°ç»‘å®šæœºåˆ¶å’Œ Validator åº“çš„ä½¿ç”¨,å¸®åŠ©ä½ æ„å»ºå¥å£®çš„ API æ¥å£ã€‚

---

## ğŸ“š æœ¬ç« ç›®æ ‡

å­¦å®Œæœ¬ç« ,ä½ å°†æŒæ¡:

1. ç†è§£ä¸ºä»€ä¹ˆéœ€è¦å‚æ•°æ ¡éªŒ
2. æŒæ¡ Gin çš„ `ShouldBindJSON` æ–¹æ³•
3. å­¦ä¼šä½¿ç”¨ Validator v10 çš„å¸¸ç”¨æ ‡ç­¾
4. äº†è§£å¦‚ä½•è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™
5. å®ç°ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

---

## 1. ä¸ºä»€ä¹ˆéœ€è¦å‚æ•°æ ¡éªŒ?

### 1.1 ç”¨æˆ·è¾“å…¥ä¸å¯ä¿¡

**æ°¸è¿œä¸è¦ç›¸ä¿¡ç”¨æˆ·è¾“å…¥!** è¿™æ˜¯ Web å¼€å‘çš„é»„é‡‘æ³•åˆ™ã€‚

```go
// âŒ å±é™©ç¤ºä¾‹:ä¸åšä»»ä½•æ ¡éªŒ
func SignUpHandler(c *gin.Context) {
    var p models.ParamSignUp
    c.ShouldBindJSON(&p)
    // ç›´æ¥ä½¿ç”¨ p.Username å’Œ p.Password,å¯èƒ½ä¸ºç©ºå­—ç¬¦ä¸²!
    logic.SignUp(&p) // ğŸ’¥ å¯èƒ½å¯¼è‡´æ•°æ®åº“æ’å…¥ç©ºå€¼æˆ–å¼‚å¸¸
}
```

**å¯èƒ½çš„é—®é¢˜:**
- ç”¨æˆ·åä¸ºç©ºæˆ–è¶…é•¿
- å¯†ç å¼ºåº¦ä¸è¶³
- é‚®ç®±æ ¼å¼ä¸æ­£ç¡®
- SQL æ³¨å…¥é£é™©
- æ¶æ„æ•°æ®å¯¼è‡´ç¨‹åºå´©æºƒ

### 1.2 æ ¡éªŒçš„å±‚æ¬¡

åœ¨ Bluebell é¡¹ç›®ä¸­,æˆ‘ä»¬é‡‡ç”¨å¤šå±‚æ ¡éªŒç­–ç•¥:

| æ ¡éªŒå±‚ | ä½ç½® | èŒè´£ | ç¤ºä¾‹ |
|--------|------|------|------|
| **å‰ç«¯æ ¡éªŒ** | Vue.js è¡¨å• | ç”¨æˆ·ä½“éªŒä¼˜åŒ–,å³æ—¶åé¦ˆ | è¾“å…¥æ—¶æç¤º"ç”¨æˆ·åä¸èƒ½ä¸ºç©º" |
| **å‚æ•°ç»‘å®šæ ¡éªŒ** | Controller å±‚ | æ ¼å¼å’Œå¿…å¡«é¡¹æ ¡éªŒ | binding:"required" |
| **ä¸šåŠ¡é€»è¾‘æ ¡éªŒ** | Logic å±‚ | ä¸šåŠ¡è§„åˆ™æ ¡éªŒ | æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨ |
| **æ•°æ®åº“çº¦æŸ** | MySQL | æœ€åçš„é˜²çº¿ | UNIQUE KEY, NOT NULL |

**åŸåˆ™:** å‰ç«¯æ ¡éªŒæå‡ç”¨æˆ·ä½“éªŒ,åç«¯æ ¡éªŒä¿éšœå®‰å…¨æ€§ã€‚åç«¯å¿…é¡»åšå®Œæ•´æ ¡éªŒ,å³ä½¿å‰ç«¯å·²ç»æ ¡éªŒè¿‡ã€‚

---

## 2. Gin å‚æ•°ç»‘å®šæœºåˆ¶

### 2.1 ç»‘å®šæ–¹æ³•å¯¹æ¯”

Gin æä¾›äº†å¤šç§å‚æ•°ç»‘å®šæ–¹æ³•:

| æ–¹æ³• | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| **ShouldBindJSON** | ä» JSON è¯·æ±‚ä½“ç»‘å®š,ä¸ä¼šç»ˆæ­¢è¯·æ±‚ | âœ… æ¨èç”¨äº API æ¥å£ |
| **BindJSON** | ä» JSON è¯·æ±‚ä½“ç»‘å®š,æ ¡éªŒå¤±è´¥è‡ªåŠ¨è¿”å› 400 | ç®€å•åœºæ™¯,ä½†æ— æ³•è‡ªå®šä¹‰é”™è¯¯å“åº” |
| **ShouldBind** | è‡ªåŠ¨è¯†åˆ« Content-Type (JSON/Form/Query) | å…¼å®¹å¤šç§è¯·æ±‚ç±»å‹ |
| **ShouldBindQuery** | ä» URL æŸ¥è¯¢å‚æ•°ç»‘å®š | GET è¯·æ±‚å‚æ•° |
| **ShouldBindUri** | ä»è·¯å¾„å‚æ•°ç»‘å®š | RESTful é£æ ¼è·¯å¾„å‚æ•° |

**æˆ‘ä»¬é€‰æ‹© `ShouldBindJSON` çš„åŸå› :**

```go
// âœ… ShouldBindJSON:æ ¡éªŒå¤±è´¥ä¸ä¼šè‡ªåŠ¨å“åº”,å¯ä»¥è‡ªå®šä¹‰é”™è¯¯æ ¼å¼
if err := c.ShouldBindJSON(&p); err != nil {
    // è‡ªå®šä¹‰é”™è¯¯å“åº”,ç»Ÿä¸€ API é£æ ¼
    ResponseError(c, CodeInvalidParam)
    return
}

// âŒ BindJSON:æ ¡éªŒå¤±è´¥è‡ªåŠ¨è¿”å› 400,æ— æ³•ç»Ÿä¸€é”™è¯¯æ ¼å¼
if err := c.BindJSON(&p); err != nil {
    // è¿™é‡Œæ°¸è¿œä¸ä¼šæ‰§è¡Œ,å› ä¸º BindJSON å·²ç»è‡ªåŠ¨å“åº”äº†
    return
}
```

### 2.2 å‚æ•°ç»“æ„ä½“å®šä¹‰

åœ¨ Bluebell é¡¹ç›®ä¸­,æˆ‘ä»¬åœ¨ `models/params.go` ä¸­å®šä¹‰æ‰€æœ‰ API å‚æ•°ç»“æ„ä½“:

```go
// models/params.go

// ParamSignUp æ³¨å†Œè¯·æ±‚å‚æ•°
// ä¸ºä»€ä¹ˆ:å®šä¹‰å‰ç«¯ä¼ é€’çš„ JSON æ•°æ®ç»“æ„,ä½¿ç”¨ binding æ ‡ç­¾è¿›è¡Œå‚æ•°æ ¡éªŒ
type ParamSignUp struct {
    // binding:"required" è¡¨ç¤ºè¯¥å­—æ®µå¿…å¡«,å¦‚æœä¸ºç©º Gin ä¼šæŠ¥é”™
    Username string `json:"username" binding:"required"`
    Password string `json:"password" binding:"required"`
    // re_password ç”¨äºç¡®è®¤å¯†ç ,ä¸šåŠ¡é€»è¾‘ä¸­ä¼šæ ¡éªŒä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´
    RePassword string `json:"re_password" binding:"required"`
}
```

**å…³é”®ç‚¹è§£æ:**

1. **json æ ‡ç­¾**: æŒ‡å®š JSON å­—æ®µå,å‰ç«¯ä¼  `"username"` ä¼šç»‘å®šåˆ° `Username` å­—æ®µ
2. **binding æ ‡ç­¾**: å®šä¹‰æ ¡éªŒè§„åˆ™,æ”¯æŒ Validator v10 çš„æ‰€æœ‰æ ‡ç­¾
3. **å­—æ®µå‘½å**: Go ç»“æ„ä½“ä½¿ç”¨å¤§é©¼å³°(PascalCase),JSON ä½¿ç”¨è›‡å½¢å‘½å(snake_case)

**å‰ç«¯è¯·æ±‚ç¤ºä¾‹:**

```json
POST /api/v1/signup
Content-Type: application/json

{
  "username": "zhangsan",
  "password": "123456",
  "re_password": "123456"
}
```

---

## 3. Validator v10 æ ‡ç­¾è¯¦è§£

### 3.1 å¸¸ç”¨æ ¡éªŒæ ‡ç­¾

Validator åº“æä¾›äº†ä¸°å¯Œçš„æ ¡éªŒæ ‡ç­¾,ä»¥ä¸‹æ˜¯æœ€å¸¸ç”¨çš„:

| æ ‡ç­¾ | å«ä¹‰ | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|------|
| **required** | å¿…å¡«å­—æ®µ | `binding:"required"` | ä¸èƒ½ä¸ºé›¶å€¼(ç©ºå­—ç¬¦ä¸²ã€0ã€false ç­‰) |
| **min** | æœ€å°å€¼/æœ€å°é•¿åº¦ | `binding:"min=3"` | å­—ç¬¦ä¸²:æœ€å°‘3ä¸ªå­—ç¬¦<br>æ•°å­—:æœ€å°å€¼ä¸º3 |
| **max** | æœ€å¤§å€¼/æœ€å¤§é•¿åº¦ | `binding:"max=64"` | å­—ç¬¦ä¸²:æœ€å¤š64ä¸ªå­—ç¬¦<br>æ•°å­—:æœ€å¤§å€¼ä¸º64 |
| **len** | å›ºå®šé•¿åº¦ | `binding:"len=11"` | å­—ç¬¦ä¸²é•¿åº¦å¿…é¡»ä¸º11(å¦‚æ‰‹æœºå·) |
| **email** | é‚®ç®±æ ¼å¼ | `binding:"email"` | å¿…é¡»æ˜¯åˆæ³•çš„é‚®ç®±åœ°å€ |
| **url** | URL æ ¼å¼ | `binding:"url"` | å¿…é¡»æ˜¯åˆæ³•çš„ URL |
| **oneof** | æšä¸¾å€¼ | `binding:"oneof=1 0 -1"` | å€¼åªèƒ½æ˜¯ 1ã€0 æˆ– -1 å…¶ä¸­ä¹‹ä¸€ |
| **gt/gte** | å¤§äº/å¤§äºç­‰äº | `binding:"gt=0"` | æ•°å­—å¿…é¡»å¤§äº 0 |
| **lt/lte** | å°äº/å°äºç­‰äº | `binding:"lt=100"` | æ•°å­—å¿…é¡»å°äº 100 |
| **eqfield** | ç­‰äºå¦ä¸€ä¸ªå­—æ®µ | `binding:"eqfield=Password"` | å¿…é¡»ä¸ Password å­—æ®µå€¼ç›¸åŒ |

### 3.2 ç»„åˆä½¿ç”¨æ ‡ç­¾

å¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”:

```go
type ParamSignUp struct {
    // ç”¨æˆ·å:å¿…å¡«,é•¿åº¦3-64ä¸ªå­—ç¬¦
    Username string `json:"username" binding:"required,min=3,max=64"`

    // å¯†ç :å¿…å¡«,é•¿åº¦6-64ä¸ªå­—ç¬¦
    Password string `json:"password" binding:"required,min=6,max=64"`

    // ç¡®è®¤å¯†ç :å¿…å¡«,ä¸”å¿…é¡»ä¸ Password å­—æ®µç›¸åŒ
    RePassword string `json:"re_password" binding:"required,eqfield=Password"`

    // é‚®ç®±:å¯é€‰,ä½†å¦‚æœå¡«å†™åˆ™å¿…é¡»æ˜¯é‚®ç®±æ ¼å¼
    Email string `json:"email" binding:"omitempty,email"`
}
```

**æ³¨æ„:**
- `required` å’Œ `omitempty` ä¸èƒ½åŒæ—¶ä½¿ç”¨
- `omitempty` è¡¨ç¤º"å¦‚æœä¸ºç©ºåˆ™è·³è¿‡åç»­æ ¡éªŒ,å¦åˆ™æ‰§è¡Œåç»­æ ¡éªŒ"

### 3.3 å®æˆ˜æ¡ˆä¾‹:æŠ•ç¥¨å‚æ•°æ ¡éªŒ

åœ¨ Bluebell çš„æŠ•ç¥¨åŠŸèƒ½ä¸­,æˆ‘ä»¬ä½¿ç”¨äº† `oneof` æ ‡ç­¾:

```go
// models/params.go

type ParamVoteData struct {
    // å¸–å­ ID:å¿…å¡«
    PostID    int64 `json:"post_id" binding:"required"`

    // æŠ•ç¥¨æ–¹å‘:å¿…å¡«,ä¸”åªèƒ½æ˜¯ 1(èµæˆ)ã€0(å–æ¶ˆ) æˆ– -1(åå¯¹)
    Direction int8  `json:"direction" binding:"required,oneof=1 0 -1"`
}
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ `oneof`?**

æŠ•ç¥¨æ–¹å‘æœ‰æ˜ç¡®çš„ä¸šåŠ¡å«ä¹‰:
- `1`: ç‚¹èµ(èµæˆ)
- `-1`: ç‚¹è¸©(åå¯¹)
- `0`: å–æ¶ˆæŠ•ç¥¨

å¦‚æœç”¨æˆ·ä¼ äº† `2` æˆ– `-5`,è¯´æ˜å‰ç«¯æœ‰ bug æˆ–ç”¨æˆ·æ¶æ„ç¯¡æ”¹è¯·æ±‚,å¿…é¡»æ‹’ç»ã€‚

**æµ‹è¯•ç¤ºä¾‹:**

```bash
# âœ… åˆæ³•è¯·æ±‚
curl -X POST http://localhost:8080/api/v1/vote \
  -H "Content-Type: application/json" \
  -d '{"post_id": 1001, "direction": 1}'

# âŒ éæ³•è¯·æ±‚:direction ä¸åœ¨å…è®¸èŒƒå›´å†…
curl -X POST http://localhost:8080/api/v1/vote \
  -H "Content-Type: application/json" \
  -d '{"post_id": 1001, "direction": 5}'
# å“åº”: {"code": 1003, "msg": "directionå¿…é¡»æ˜¯[1 0 -1]ä¸­çš„ä¸€ä¸ª"}
```

---

## 4. Controller å±‚å‚æ•°æ ¡éªŒå®ç°

### 4.1 æ ‡å‡†æ ¡éªŒæµç¨‹

åœ¨ Bluebell é¡¹ç›®ä¸­,æ‰€æœ‰ Controller çš„å‚æ•°æ ¡éªŒéƒ½éµå¾ªç»Ÿä¸€æ¨¡å¼:

```go
// controller/user.go

func SignUpHandler(c *gin.Context) {
    // 1ï¸âƒ£ åˆ›å»ºå‚æ•°ç»“æ„ä½“
    p := new(models.ParamSignUp)

    // 2ï¸âƒ£ å‚æ•°ç»‘å®šå’Œæ ¡éªŒ
    if err := c.ShouldBindJSON(p); err != nil {
        // 3ï¸âƒ£ ç±»å‹æ–­è¨€:åˆ¤æ–­æ˜¯å¦æ˜¯ Validator æ ¡éªŒé”™è¯¯
        errs, ok := err.(validator.ValidationErrors)
        if !ok {
            // éæ ¡éªŒé”™è¯¯(å¦‚ JSON æ ¼å¼é”™è¯¯),è¿”å›é€šç”¨é”™è¯¯
            ResponseError(c, CodeInvalidParam)
            return
        }

        // 4ï¸âƒ£ ç¿»è¯‘é”™è¯¯ä¿¡æ¯ä¸ºä¸­æ–‡,å¹¶å»é™¤ç»“æ„ä½“åå‰ç¼€
        ResponseErrorWithMsg(c, CodeInvalidParam, removeTopStruct(errs.Translate(trans)))
        return
    }

    // 5ï¸âƒ£ å‚æ•°æ ¡éªŒé€šè¿‡,è°ƒç”¨ä¸šåŠ¡é€»è¾‘
    if err := logic.SignUp(p); err != nil {
        // ä¸šåŠ¡é”™è¯¯å¤„ç†
        if errors.Is(err, mysql.ErrorUserExist) {
            ResponseError(c, CodeUserExist)
            return
        }
        ResponseError(c, CodeServerBusy)
        return
    }

    // 6ï¸âƒ£ è¿”å›æˆåŠŸå“åº”
    ResponseSuccess(c, nil)
}
```

### 4.2 ä¸ºä»€ä¹ˆéœ€è¦ç±»å‹æ–­è¨€?

`ShouldBindJSON` å¯èƒ½è¿”å›ä¸¤ç±»é”™è¯¯:

```go
// é”™è¯¯ç±»å‹1: JSON è§£æé”™è¯¯
{
  "username": "zhangsan",
  "password": "123456",  // â† å°‘äº†é€—å·
  "re_password": "123456"
}
// è¿”å›é”™è¯¯: invalid character '"' after object key:value pair

// é”™è¯¯ç±»å‹2: Validator æ ¡éªŒé”™è¯¯
{
  "username": "",        // â† ç©ºå­—ç¬¦ä¸²,è¿å required è§„åˆ™
  "password": "123456",
  "re_password": "123456"
}
// è¿”å›é”™è¯¯: validator.ValidationErrors ç±»å‹
```

**å¤„ç†é€»è¾‘:**

```go
errs, ok := err.(validator.ValidationErrors)
if !ok {
    // ä¸æ˜¯ ValidationErrors,è¯´æ˜æ˜¯ JSON æ ¼å¼é”™è¯¯ç­‰é—®é¢˜
    ResponseError(c, CodeInvalidParam)
    return
}
// æ˜¯ ValidationErrors,éœ€è¦ç¿»è¯‘æˆç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
ResponseErrorWithMsg(c, CodeInvalidParam, removeTopStruct(errs.Translate(trans)))
```

### 4.3 é”™è¯¯ä¿¡æ¯ç¿»è¯‘

Validator é»˜è®¤è¿”å›è‹±æ–‡é”™è¯¯ä¿¡æ¯,ä¸”åŒ…å«ç»“æ„ä½“åå‰ç¼€:

```
ParamSignUp.Username: 'Username' å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹
ParamSignUp.Password: 'Password' é•¿åº¦å¿…é¡»è‡³å°‘ä¸º6ä¸ªå­—ç¬¦
```

æˆ‘ä»¬åšäº†ä¸¤å±‚ä¼˜åŒ–:

#### ç¬¬ä¸€å±‚:å›½é™…åŒ–ç¿»è¯‘

åœ¨ `controller/validator.go` ä¸­åˆå§‹åŒ–ç¿»è¯‘å™¨:

```go
import (
    "github.com/gin-gonic/gin/binding"
    "github.com/go-playground/validator/v10"
    zh_translations "github.com/go-playground/validator/v10/translations/zh"
    ut "github.com/go-playground/universal-translator"
)

var trans ut.Translator // å…¨å±€ç¿»è¯‘å™¨

func InitTrans(locale string) (err error) {
    if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
        // è®¾ç½®ç¿»è¯‘å™¨
        zhT := zh.New()  // ä¸­æ–‡ç¿»è¯‘å™¨
        enT := en.New()  // è‹±æ–‡ç¿»è¯‘å™¨
        uni := ut.New(enT, zhT, enT)

        // æ ¹æ®å‚æ•°é€‰æ‹©è¯­è¨€
        trans, ok = uni.GetTranslator(locale)
        if !ok {
            return fmt.Errorf("uni.GetTranslator(%s) failed", locale)
        }

        // æ³¨å†Œç¿»è¯‘å™¨
        switch locale {
        case "zh":
            err = zh_translations.RegisterDefaultTranslations(v, trans)
        case "en":
            err = en_translations.RegisterDefaultTranslations(v, trans)
        default:
            err = en_translations.RegisterDefaultTranslations(v, trans)
        }
        return
    }
    return
}
```

**åœ¨ main.go ä¸­è°ƒç”¨:**

```go
// åˆå§‹åŒ– Validator ç¿»è¯‘å™¨
if err := controller.InitTrans("zh"); err != nil {
    fmt.Printf("init validator trans failed, err:%v\n", err)
    return
}
```

#### ç¬¬äºŒå±‚:å»é™¤ç»“æ„ä½“åå‰ç¼€

ç¿»è¯‘åçš„é”™è¯¯ä¿¡æ¯ä»ç„¶åŒ…å« `ParamSignUp.` å‰ç¼€,ç”¨æˆ·ä½“éªŒä¸å¥½ã€‚æˆ‘ä»¬ä½¿ç”¨ `removeTopStruct` å‡½æ•°å»é™¤:

```go
// controller/validator.go

func removeTopStruct(fields map[string]string) map[string]string {
    res := map[string]string{}
    for field, err := range fields {
        // å»æ‰ç»“æ„ä½“åå‰ç¼€
        // ä¾‹å¦‚: "ParamSignUp.Username" â†’ "Username"
        res[field[strings.Index(field, ".")+1:]] = err
    }
    return res
}
```

**æ•ˆæœå¯¹æ¯”:**

```go
// âŒ ä¼˜åŒ–å‰
{
  "code": 1003,
  "msg": "è¯·æ±‚å‚æ•°æœ‰è¯¯",
  "data": {
    "ParamSignUp.Username": "Usernameä¸ºå¿…å¡«å­—æ®µ",
    "ParamSignUp.Password": "Passwordé•¿åº¦å¿…é¡»è‡³å°‘ä¸º6ä¸ªå­—ç¬¦"
  }
}

// âœ… ä¼˜åŒ–å
{
  "code": 1003,
  "msg": "è¯·æ±‚å‚æ•°æœ‰è¯¯",
  "data": {
    "username": "usernameä¸ºå¿…å¡«å­—æ®µ",
    "password": "passwordé•¿åº¦å¿…é¡»è‡³å°‘ä¸º6ä¸ªå­—ç¬¦"
  }
}
```

**æ³¨æ„:** ä¼˜åŒ–åçš„å­—æ®µåä½¿ç”¨ JSON æ ‡ç­¾(å°å†™),è€Œé Go å­—æ®µå(å¤§é©¼å³°),è¿™éœ€è¦é¢å¤–é…ç½®ã€‚

---

## 5. è‡ªå®šä¹‰å­—æ®µåæ˜¾ç¤º

### 5.1 é—®é¢˜:å­—æ®µåä¸å‹å¥½

é»˜è®¤æƒ…å†µä¸‹,Validator ä½¿ç”¨ Go ç»“æ„ä½“çš„å­—æ®µå(å¦‚ `Username`),ä½†å‰ç«¯ä½¿ç”¨çš„æ˜¯ JSON å­—æ®µå(å¦‚ `username`)ã€‚

**æˆ‘ä»¬å¸Œæœ›:**
- é”™è¯¯ä¿¡æ¯ä¸­çš„å­—æ®µåä¸å‰ç«¯ JSON å­—æ®µä¸€è‡´
- ä¾¿äºå‰ç«¯è§£æå’Œå±•ç¤ºé”™è¯¯

### 5.2 è§£å†³æ–¹æ¡ˆ:æ³¨å†Œ TagNameFunc

åœ¨ `InitTrans` å‡½æ•°ä¸­æ·»åŠ :

```go
func InitTrans(locale string) (err error) {
    if v, ok := binding.Validator.Engine().(*validator.Validate); ok {

        // ğŸ”¥ æ³¨å†Œ JSON æ ‡ç­¾åå‡½æ•°
        // è®© Validator ä½¿ç”¨ json æ ‡ç­¾ä½œä¸ºå­—æ®µå,è€Œé Go å­—æ®µå
        v.RegisterTagNameFunc(func(fld reflect.StructField) string {
            // è·å– json æ ‡ç­¾çš„ç¬¬ä¸€éƒ¨åˆ†(é€—å·å‰)
            // ä¾‹å¦‚: `json:"username,omitempty"` â†’ "username"
            name := strings.SplitN(fld.Tag.Get("json"), ",", 2)[0]
            if name == "-" {
                // json:"-" è¡¨ç¤ºå¿½ç•¥è¯¥å­—æ®µ
                return ""
            }
            return name
        })

        // ... åç»­ç¿»è¯‘å™¨æ³¨å†Œä»£ç  ...
    }
    return
}
```

**æ•ˆæœ:**

```go
type ParamSignUp struct {
    Username string `json:"username" binding:"required"`
}

// âŒ æœªæ³¨å†Œ TagNameFunc
errs.Translate(trans)
// è¿”å›: {"Username": "Usernameä¸ºå¿…å¡«å­—æ®µ"}

// âœ… æ³¨å†Œ TagNameFunc å
errs.Translate(trans)
// è¿”å›: {"username": "usernameä¸ºå¿…å¡«å­—æ®µ"}
```

---

## 6. è·¨å­—æ®µæ ¡éªŒ

### 6.1 ä¸šåŠ¡éœ€æ±‚

æ³¨å†Œæ—¶,ç”¨æˆ·éœ€è¦è¾“å…¥ä¸¤æ¬¡å¯†ç ä»¥ç¡®ä¿æ— è¯¯:

```json
{
  "username": "zhangsan",
  "password": "123456",
  "re_password": "123456"  // â† å¿…é¡»ä¸ password ç›¸åŒ
}
```

å•ä¸ªå­—æ®µçš„ `binding` æ ‡ç­¾æ— æ³•å®ç°è¿™ä¸ªé€»è¾‘,éœ€è¦è‡ªå®šä¹‰æ ¡éªŒã€‚

### 6.2 æ–¹æ³•1:ä½¿ç”¨ eqfield æ ‡ç­¾

æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨å†…ç½®çš„ `eqfield` æ ‡ç­¾:

```go
type ParamSignUp struct {
    Username   string `json:"username" binding:"required"`
    Password   string `json:"password" binding:"required"`
    RePassword string `json:"re_password" binding:"required,eqfield=Password"`
    //                                               ^^^^^^^^^^^^^^^^^^^^^^
    //                                               å¿…é¡»ç­‰äº Password å­—æ®µ
}
```

**ä¼˜ç‚¹:** ç®€å•ç›´æ¥,ä¸€è¡Œä»£ç æå®š

**ç¼ºç‚¹:** é”™è¯¯ä¿¡æ¯ä¸å‹å¥½

```json
{
  "code": 1003,
  "msg": "è¯·æ±‚å‚æ•°æœ‰è¯¯",
  "data": {
    "re_password": "re_passwordå¿…é¡»ç­‰äºPassword"  // â† é”™è¯¯ä¿¡æ¯åŒ…å«å­—æ®µå,ä¸å¤Ÿå‹å¥½
  }
}
```

### 6.3 æ–¹æ³•2:è‡ªå®šä¹‰ç»“æ„ä½“çº§åˆ«æ ¡éªŒ

ä¸ºäº†æ›´å‹å¥½çš„é”™è¯¯æç¤º,Bluebell ä½¿ç”¨äº†ç»“æ„ä½“çº§åˆ«çš„è‡ªå®šä¹‰æ ¡éªŒ:

```go
// controller/validator.go

// SignUpParamStructLevelValidation æ³¨å†Œå‚æ•°è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°
func SignUpParamStructLevelValidation(sl validator.StructLevel) {
    // è·å–å½“å‰æ ¡éªŒçš„ç»“æ„ä½“å®ä¾‹
    su := sl.Current().Interface().(models.ParamSignUp)

    // ä¸šåŠ¡é€»è¾‘:ä¸¤æ¬¡å¯†ç å¿…é¡»ä¸€è‡´
    if su.Password != su.RePassword {
        // æŠ¥å‘Šé”™è¯¯:å­—æ®µ re_password ä¸æ»¡è¶³ eqfield è§„åˆ™
        sl.ReportError(su.RePassword, "re_password", "RePassword", "eqfield", "password")
        //             ^^^^^^^^^^^^^^  ^^^^^^^^^^^^^  ^^^^^^^^^^^  ^^^^^^^^^  ^^^^^^^^^^
        //             å­—æ®µå€¼          JSONå­—æ®µå     Goå­—æ®µå      æ ¡éªŒæ ‡ç­¾    æ ‡ç­¾å‚æ•°
    }
}
```

**æ³¨å†Œè‡ªå®šä¹‰æ ¡éªŒ:**

```go
func InitTrans(locale string) (err error) {
    if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
        // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...

        // ğŸ”¥ æ³¨å†Œç»“æ„ä½“çº§åˆ«æ ¡éªŒ
        v.RegisterStructValidation(SignUpParamStructLevelValidation, models.ParamSignUp{})
        //                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^
        //                          è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°                     è¦æ ¡éªŒçš„ç»“æ„ä½“ç±»å‹
    }
    return
}
```

**ä¼˜åŠ¿:**
- æ›´çµæ´»çš„æ ¡éªŒé€»è¾‘(å¯ä»¥è°ƒç”¨å¤–éƒ¨å‡½æ•°ã€æŸ¥è¯¢æ•°æ®åº“ç­‰)
- å¯ä»¥è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯

---

## 7. å®Œæ•´çš„å‚æ•°æ ¡éªŒç¤ºä¾‹

### 7.1 ç”¨æˆ·æ³¨å†Œå‚æ•°

```go
// models/params.go

type ParamSignUp struct {
    // ç”¨æˆ·å:å¿…å¡«,3-64å­—ç¬¦
    Username string `json:"username" binding:"required,min=3,max=64"`

    // å¯†ç :å¿…å¡«,6-64å­—ç¬¦
    Password string `json:"password" binding:"required,min=6,max=64"`

    // ç¡®è®¤å¯†ç :å¿…å¡«(é€šè¿‡è‡ªå®šä¹‰æ ¡éªŒéªŒè¯ä¸€è‡´æ€§)
    RePassword string `json:"re_password" binding:"required"`
}
```

### 7.2 ç”¨æˆ·ç™»å½•å‚æ•°

```go
// models/params.go

type ParamLogin struct {
    // ç™»å½•æ—¶åªéœ€è¦ç”¨æˆ·åå’Œå¯†ç ,ä¸éœ€è¦ç¡®è®¤å¯†ç 
    Username string `json:"username" binding:"required"`
    Password string `json:"password" binding:"required"`
}
```

**è®¾è®¡åŸåˆ™:** æ³¨å†Œå’Œç™»å½•ä½¿ç”¨ä¸åŒçš„å‚æ•°ç»“æ„ä½“,è™½ç„¶å­—æ®µç›¸ä¼¼,ä½†ä¸šåŠ¡å«ä¹‰ä¸åŒ,è§£è€¦æ›´çµæ´»ã€‚

### 7.3 å¸–å­åˆ—è¡¨æŸ¥è¯¢å‚æ•°

```go
// models/params.go

type ParamPostList struct {
    // é¡µç :é»˜è®¤ä¸º1
    Page int64 `json:"page" form:"page"`

    // æ¯é¡µæ•°é‡:é»˜è®¤ä¸º10
    Size int64 `json:"size" form:"size"`

    // æ’åºæ–¹å¼:"time" æˆ– "score"
    Order string `json:"order" form:"order"`

    // ç¤¾åŒºID:å¯é€‰,æŒ‰ç¤¾åŒºç­›é€‰
    CommunityID int64 `json:"community_id" form:"community_id"`
}
```

**æ³¨æ„:** `form:"page"` æ ‡ç­¾å…è®¸ä» URL æŸ¥è¯¢å‚æ•°ä¸­ç»‘å®š:

```bash
GET /api/v1/posts?page=2&size=20&order=score&community_id=1
```

---

## 8. æœ€ä½³å®è·µ

### 8.1 å‚æ•°æ ¡éªŒæ¸…å•

åœ¨ç¼–å†™ Controller æ—¶,ç¡®ä¿åšåˆ°:

- âœ… æ‰€æœ‰å¿…å¡«å­—æ®µéƒ½æœ‰ `required` æ ‡ç­¾
- âœ… å­—ç¬¦ä¸²å­—æ®µé™åˆ¶æœ€å¤§é•¿åº¦(é˜²æ­¢è¶…é•¿æ”»å‡»)
- âœ… æ•°å­—å­—æ®µé™åˆ¶èŒƒå›´(é˜²æ­¢éæ³•å€¼)
- âœ… æšä¸¾å­—æ®µä½¿ç”¨ `oneof` æ ‡ç­¾
- âœ… é‚®ç®±ã€URL ç­‰ä½¿ç”¨å¯¹åº”çš„æ ¼å¼æ ¡éªŒæ ‡ç­¾
- âœ… è·¨å­—æ®µæ ¡éªŒä½¿ç”¨è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°
- âœ… é”™è¯¯ä¿¡æ¯ç¿»è¯‘æˆä¸­æ–‡å¹¶å»é™¤ç»“æ„ä½“å‰ç¼€

### 8.2 é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€

```go
// âœ… å¥½çš„åšæ³•:ä½¿ç”¨ç»Ÿä¸€çš„å“åº”å‡½æ•°
if err := c.ShouldBindJSON(&p); err != nil {
    ResponseError(c, CodeInvalidParam)  // ç»Ÿä¸€æ ¼å¼
    return
}

// âŒ ä¸å¥½çš„åšæ³•:ç›´æ¥è¿”å› JSON
if err := c.ShouldBindJSON(&p); err != nil {
    c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
    return
}
```

### 8.3 ä¸è¦åœ¨ Controller å†™ä¸šåŠ¡é€»è¾‘

```go
// âŒ é”™è¯¯ç¤ºä¾‹:åœ¨ Controller åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨
func SignUpHandler(c *gin.Context) {
    var p models.ParamSignUp
    c.ShouldBindJSON(&p)

    // âŒ è¿™æ˜¯ä¸šåŠ¡é€»è¾‘,ä¸åº”è¯¥åœ¨ Controller
    if mysql.CheckUserExist(p.Username) {
        ResponseError(c, CodeUserExist)
        return
    }
    // ...
}

// âœ… æ­£ç¡®ç¤ºä¾‹:Controller åªè´Ÿè´£å‚æ•°å’Œå“åº”,ä¸šåŠ¡é€»è¾‘äº¤ç»™ Logic å±‚
func SignUpHandler(c *gin.Context) {
    var p models.ParamSignUp
    if err := c.ShouldBindJSON(&p); err != nil {
        // Controller åªå¤„ç†å‚æ•°æ ¡éªŒ
        ResponseError(c, CodeInvalidParam)
        return
    }

    // âœ… ä¸šåŠ¡é€»è¾‘åœ¨ Logic å±‚
    if err := logic.SignUp(&p); err != nil {
        // Controller åªå¤„ç†å“åº”
        if errors.Is(err, mysql.ErrorUserExist) {
            ResponseError(c, CodeUserExist)
            return
        }
        ResponseError(c, CodeServerBusy)
        return
    }

    ResponseSuccess(c, nil)
}
```

### 8.4 å‚æ•°å‘½åè§„èŒƒ

```go
// âœ… å¥½çš„å‘½å
type ParamSignUp struct {
    Username   string `json:"username" binding:"required"`
    Password   string `json:"password" binding:"required"`
    RePassword string `json:"re_password" binding:"required"`
}

// âŒ ä¸å¥½çš„å‘½å
type SignUpRequest struct {  // ä¸è¦ç”¨ Request/Response åç¼€
    Name string `json:"name"`  // å¤ªæ¨¡ç³Š,åº”è¯¥æ˜¯ Username
    Pwd  string `json:"pwd"`   // ç¼©å†™ä¸æ¸…æ™°,åº”è¯¥æ˜¯ Password
    Pwd2 string `json:"pwd2"`  // è¯­ä¹‰ä¸æ˜ç¡®,åº”è¯¥æ˜¯ RePassword
}
```

---

## 9. å¸¸è§é—®é¢˜ FAQ

### Q1: binding:"required" å’Œ binding:"omitempty" æœ‰ä»€ä¹ˆåŒºåˆ«?

**A:**

- `required`: å­—æ®µä¸èƒ½ä¸ºé›¶å€¼(ç©ºå­—ç¬¦ä¸²ã€0ã€falseã€nil ç­‰),**å¿…é¡»æœ‰å€¼**
- `omitempty`: å­—æ®µä¸ºé›¶å€¼æ—¶**è·³è¿‡åç»­æ ¡éªŒ**,éé›¶å€¼æ—¶æ‰§è¡Œåç»­æ ¡éªŒ

```go
// ç¤ºä¾‹1: Email å¿…å¡«
type User struct {
    Email string `binding:"required,email"`  // å¿…é¡»å¡«å†™ä¸”æ ¼å¼æ­£ç¡®
}

// ç¤ºä¾‹2: Email å¯é€‰
type User struct {
    Email string `binding:"omitempty,email"`  // ä¸å¡«å¯ä»¥,å¡«äº†å°±å¿…é¡»æ ¼å¼æ­£ç¡®
}

// âŒ é”™è¯¯ç”¨æ³•
type User struct {
    Email string `binding:"required,omitempty,email"`  // çŸ›ç›¾!ä¸èƒ½åŒæ—¶ä½¿ç”¨
}
```

---

### Q2: ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ ShouldBindJSON è€Œä¸æ˜¯ BindJSON?

**A:**

| æ–¹æ³• | æ ¡éªŒå¤±è´¥å | è‡ªå®šä¹‰é”™è¯¯å“åº” | æ¨èåœºæ™¯ |
|------|-----------|---------------|---------|
| **ShouldBindJSON** | è¿”å› error,ä¸è‡ªåŠ¨å“åº” | âœ… å¯ä»¥ | ç”Ÿäº§ç¯å¢ƒ,éœ€è¦ç»Ÿä¸€é”™è¯¯æ ¼å¼ |
| **BindJSON** | è‡ªåŠ¨è¿”å› 400 Bad Request | âŒ ä¸å¯ä»¥ | å¿«é€ŸåŸå‹å¼€å‘ |

**ç¤ºä¾‹:**

```go
// âœ… ShouldBindJSON:å¯æ§åˆ¶å“åº”æ ¼å¼
if err := c.ShouldBindJSON(&p); err != nil {
    ResponseError(c, CodeInvalidParam)  // è¿”å›è‡ªå®šä¹‰é”™è¯¯ç å’Œæ ¼å¼
    return
}

// âŒ BindJSON:æ— æ³•è‡ªå®šä¹‰
if err := c.BindJSON(&p); err != nil {
    // è¿™é‡Œæ°¸è¿œä¸ä¼šæ‰§è¡Œ,å› ä¸º BindJSON å·²ç»è‡ªåŠ¨å“åº”äº†:
    // HTTP 400: {"error": "Key: 'ParamSignUp.Username' Error:Field validation..."}
    return
}
```

---

### Q3: å¦‚ä½•æ ¡éªŒå¯†ç å¼ºåº¦?

**A:**

Validator æ²¡æœ‰å†…ç½®å¯†ç å¼ºåº¦æ ¡éªŒ,éœ€è¦è‡ªå®šä¹‰:

```go
// æ–¹æ³•1:ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼(ä¸æ¨è,æ­£åˆ™éš¾ç»´æŠ¤)
type ParamSignUp struct {
    // å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
    Password string `binding:"required,min=8,regexp=^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).+$"`
}

// æ–¹æ³•2:è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°(æ¨è)
func validatePassword(fl validator.FieldLevel) bool {
    password := fl.Field().String()

    // å¯†ç ç­–ç•¥:è‡³å°‘8ä½,åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
    if len(password) < 8 {
        return false
    }

    hasUpper := false
    hasLower := false
    hasDigit := false

    for _, c := range password {
        if unicode.IsUpper(c) {
            hasUpper = true
        } else if unicode.IsLower(c) {
            hasLower = true
        } else if unicode.IsDigit(c) {
            hasDigit = true
        }
    }

    return hasUpper && hasLower && hasDigit
}

// åœ¨ InitTrans ä¸­æ³¨å†Œ
v.RegisterValidation("strong_password", validatePassword)

// ä½¿ç”¨
type ParamSignUp struct {
    Password string `binding:"required,strong_password"`
}
```

---

### Q4: å¦‚ä½•å¤„ç†å¯é€‰å­—æ®µ?

**A:**

ä½¿ç”¨ `omitempty` æ ‡ç­¾:

```go
type ParamSignUp struct {
    Username string `json:"username" binding:"required"`
    Password string `json:"password" binding:"required"`

    // Email æ˜¯å¯é€‰çš„,ä½†å¦‚æœæä¾›äº†,å¿…é¡»æ˜¯åˆæ³•çš„é‚®ç®±æ ¼å¼
    Email *string `json:"email" binding:"omitempty,email"`
    //    ^^^^^^^ ä½¿ç”¨æŒ‡é’ˆç±»å‹,åŒºåˆ†"æœªæä¾›"å’Œ"ç©ºå­—ç¬¦ä¸²"
}
```

**åŒºåˆ«:**

```go
// æƒ…å†µ1: æœªæä¾› email å­—æ®µ
{"username": "zhangsan", "password": "123456"}
// Email ä¸º nil,æ ¡éªŒé€šè¿‡ âœ…

// æƒ…å†µ2: æä¾›äº† email,ä½†ä¸ºç©º
{"username": "zhangsan", "password": "123456", "email": ""}
// Email ä¸º "",æ ¡éªŒå¤±è´¥ âŒ (ç©ºå­—ç¬¦ä¸²ä¸æ˜¯åˆæ³•é‚®ç®±)

// æƒ…å†µ3: æä¾›äº†åˆæ³• email
{"username": "zhangsan", "password": "123456", "email": "test@example.com"}
// Email ä¸º "test@example.com",æ ¡éªŒé€šè¿‡ âœ…
```

---

### Q5: å‰ç«¯å¦‚ä½•å±•ç¤ºæ ¡éªŒé”™è¯¯?

**A:**

åç«¯è¿”å›çš„é”™è¯¯æ ¼å¼:

```json
{
  "code": 1003,
  "msg": "è¯·æ±‚å‚æ•°æœ‰è¯¯",
  "data": {
    "username": "usernameé•¿åº¦å¿…é¡»è‡³å°‘ä¸º3ä¸ªå­—ç¬¦",
    "password": "passwordé•¿åº¦å¿…é¡»è‡³å°‘ä¸º6ä¸ªå­—ç¬¦"
  }
}
```

å‰ç«¯å¯ä»¥è¿™æ ·å¤„ç†:

```javascript
// Vue 3 ç¤ºä¾‹
async function handleSignup() {
  try {
    await api.signup(formData)
  } catch (error) {
    if (error.response.data.code === 1003) {
      const errors = error.response.data.data

      // æ–¹æ³•1:é€ä¸ªå±•ç¤º
      for (const [field, msg] of Object.entries(errors)) {
        ElMessage.error(`${field}: ${msg}`)
      }

      // æ–¹æ³•2:è®¾ç½®åˆ°è¡¨å•æ ¡éªŒæç¤º
      Object.keys(errors).forEach(field => {
        formRef.value.setFieldError(field, errors[field])
      })
    }
  }
}
```

---

## 10. çŸ¥è¯†å›é¡¾

é€šè¿‡æœ¬ç« å­¦ä¹ ,ä½ åº”è¯¥æŒæ¡äº†:

âœ… **å‚æ•°æ ¡éªŒçš„é‡è¦æ€§**
   - ç”¨æˆ·è¾“å…¥ä¸å¯ä¿¡,åç«¯å¿…é¡»åšå®Œæ•´æ ¡éªŒ
   - å¤šå±‚æ ¡éªŒç­–ç•¥:å‰ç«¯(ä½“éªŒ) + åç«¯(å®‰å…¨) + æ•°æ®åº“(æœ€åé˜²çº¿)

âœ… **Gin å‚æ•°ç»‘å®š**
   - `ShouldBindJSON` ä» JSON è¯·æ±‚ä½“ç»‘å®šå‚æ•°
   - ç»‘å®šå¤±è´¥è¿”å› error,å¯è‡ªå®šä¹‰é”™è¯¯å“åº”
   - å‚æ•°ç»“æ„ä½“ä½¿ç”¨ `json` å’Œ `binding` æ ‡ç­¾

âœ… **Validator v10 æ ‡ç­¾**
   - `required`: å¿…å¡«
   - `min/max`: æœ€å°/æœ€å¤§é•¿åº¦æˆ–å€¼
   - `email/url`: æ ¼å¼æ ¡éªŒ
   - `oneof`: æšä¸¾å€¼æ ¡éªŒ
   - `eqfield`: å­—æ®µç›¸ç­‰æ ¡éªŒ

âœ… **é”™è¯¯ä¿¡æ¯ä¼˜åŒ–**
   - å›½é™…åŒ–ç¿»è¯‘(ä¸­æ–‡/è‹±æ–‡)
   - å»é™¤ç»“æ„ä½“åå‰ç¼€
   - ä½¿ç”¨ JSON å­—æ®µåè€Œé Go å­—æ®µå

âœ… **è‡ªå®šä¹‰æ ¡éªŒ**
   - `RegisterTagNameFunc`: è‡ªå®šä¹‰å­—æ®µåæ˜¾ç¤º
   - `RegisterStructValidation`: ç»“æ„ä½“çº§åˆ«è·¨å­—æ®µæ ¡éªŒ
   - `RegisterValidation`: æ³¨å†Œè‡ªå®šä¹‰æ ¡éªŒæ ‡ç­¾

âœ… **æœ€ä½³å®è·µ**
   - Controller åªè´Ÿè´£å‚æ•°æ ¡éªŒå’Œå“åº”,ä¸å†™ä¸šåŠ¡é€»è¾‘
   - ä½¿ç”¨ç»Ÿä¸€çš„ `ResponseError` å’Œ `ResponseSuccess` å‡½æ•°
   - å‚æ•°ç»“æ„ä½“å®šä¹‰åœ¨ `models/params.go` ä¸­

---

## 11. è¯¾åç»ƒä¹ 

### ç»ƒä¹ 1:å®ç°æ–‡ç« å‘å¸ƒå‚æ•°æ ¡éªŒ

**éœ€æ±‚:** å®ç°æ–‡ç« å‘å¸ƒæ¥å£çš„å‚æ•°æ ¡éªŒ

```go
// å‚æ•°è¦æ±‚:
// - title: å¿…å¡«,1-100å­—ç¬¦
// - content: å¿…å¡«,10-10000å­—ç¬¦
// - category: å¿…å¡«,åªèƒ½æ˜¯ "tech", "life", "other" ä¹‹ä¸€
// - tags: å¯é€‰,å¦‚æœæä¾›åˆ™é•¿åº¦ä¸è¶…è¿‡5ä¸ª

type ParamCreatePost struct {
    // è¯·è¡¥å……ä»£ç 
}
```

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</summary>

```go
type ParamCreatePost struct {
    Title    string   `json:"title" binding:"required,min=1,max=100"`
    Content  string   `json:"content" binding:"required,min=10,max=10000"`
    Category string   `json:"category" binding:"required,oneof=tech life other"`
    Tags     []string `json:"tags" binding:"omitempty,max=5,dive,min=1,max=20"`
    //                                                      ^^^^ dive è¡¨ç¤ºæ·±å…¥åˆ°æ•°ç»„å…ƒç´ è¿›è¡Œæ ¡éªŒ
}
```
</details>

### ç»ƒä¹ 2:å®ç°ä¿®æ”¹å¯†ç å‚æ•°æ ¡éªŒ

**éœ€æ±‚:** ç”¨æˆ·ä¿®æ”¹å¯†ç æ—¶éœ€è¦è¾“å…¥:æ—§å¯†ç ã€æ–°å¯†ç ã€ç¡®è®¤æ–°å¯†ç 

```go
// å‚æ•°è¦æ±‚:
// - old_password: å¿…å¡«
// - new_password: å¿…å¡«,6-64å­—ç¬¦,ä¸”ä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ
// - re_new_password: å¿…å¡«,å¿…é¡»ä¸ new_password ç›¸åŒ

type ParamChangePassword struct {
    // è¯·è¡¥å……ä»£ç 
}

// è¯·ç¼–å†™è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°
func ChangePasswordStructLevelValidation(sl validator.StructLevel) {
    // è¯·è¡¥å……ä»£ç 
}
```

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</summary>

```go
type ParamChangePassword struct {
    OldPassword     string `json:"old_password" binding:"required"`
    NewPassword     string `json:"new_password" binding:"required,min=6,max=64"`
    ReNewPassword   string `json:"re_new_password" binding:"required"`
}

func ChangePasswordStructLevelValidation(sl validator.StructLevel) {
    cp := sl.Current().Interface().(ParamChangePassword)

    // æ–°å¯†ç å¿…é¡»ä¸æ—§å¯†ç ä¸åŒ
    if cp.NewPassword == cp.OldPassword {
        sl.ReportError(cp.NewPassword, "new_password", "NewPassword", "nefield", "old_password")
    }

    // ä¸¤æ¬¡æ–°å¯†ç å¿…é¡»ä¸€è‡´
    if cp.NewPassword != cp.ReNewPassword {
        sl.ReportError(cp.ReNewPassword, "re_new_password", "ReNewPassword", "eqfield", "new_password")
    }
}

// æ³¨å†Œæ ¡éªŒ
v.RegisterStructValidation(ChangePasswordStructLevelValidation, models.ParamChangePassword{})
```
</details>

### ç»ƒä¹ 3:å®ç°åˆ†é¡µå‚æ•°æ ¡éªŒ

**éœ€æ±‚:** å®ç°é€šç”¨çš„åˆ†é¡µå‚æ•°æ ¡éªŒ

```go
// å‚æ•°è¦æ±‚:
// - page: å¯é€‰,é»˜è®¤1,æœ€å°å€¼ä¸º1
// - page_size: å¯é€‰,é»˜è®¤10,èŒƒå›´ä¸º1-100

type ParamPagination struct {
    // è¯·è¡¥å……ä»£ç 
}
```

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</summary>

```go
type ParamPagination struct {
    Page     int `json:"page" form:"page" binding:"omitempty,min=1"`
    PageSize int `json:"page_size" form:"page_size" binding:"omitempty,min=1,max=100"`
}

// åœ¨ Controller ä¸­è®¾ç½®é»˜è®¤å€¼
func GetPostListHandler(c *gin.Context) {
    var p ParamPagination
    if err := c.ShouldBindQuery(&p); err != nil {
        ResponseError(c, CodeInvalidParam)
        return
    }

    // è®¾ç½®é»˜è®¤å€¼
    if p.Page == 0 {
        p.Page = 1
    }
    if p.PageSize == 0 {
        p.PageSize = 10
    }

    // è°ƒç”¨ä¸šåŠ¡é€»è¾‘
    data, err := logic.GetPostList(&p)
    // ...
}
```
</details>

---

## 12. å»¶ä¼¸é˜…è¯»

- ğŸ“– [Validator v10 å®˜æ–¹æ–‡æ¡£](https://github.com/go-playground/validator)
- ğŸ“– [Gin å‚æ•°ç»‘å®šå®Œæ•´æŒ‡å—](https://gin-gonic.com/docs/examples/binding-and-validation/)
- ğŸ“– ä¸‹ä¸€ç« : [ç¬¬05ç« :ä¼˜é›…çš„å‚æ•°æ ¡éªŒä¸é”™è¯¯ç¿»è¯‘](./05-ä¼˜é›…çš„å‚æ•°æ ¡éªŒä¸é”™è¯¯ç¿»è¯‘.md)

---

**æ­å–œ!** ä½ å·²ç»æŒæ¡äº† Gin æ¡†æ¶çš„å‚æ•°ç»‘å®šå’Œæ ¡éªŒæœºåˆ¶ã€‚ä¸‹ä¸€ç« æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è¿›ä¸€æ­¥ä¼˜åŒ–é”™è¯¯æç¤º,è®©ç”¨æˆ·ä½“éªŒæ›´ä¸Šä¸€å±‚æ¥¼ã€‚ğŸ’ª
