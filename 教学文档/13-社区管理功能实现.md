# ç¬¬13ç« :ç¤¾åŒºç®¡ç†åŠŸèƒ½å®ç°

> **æœ¬ç« å¯¼è¯»**
>
> åœ¨å‰é¢çš„ç« èŠ‚ä¸­,æˆ‘ä»¬å®Œæˆäº†ç”¨æˆ·è®¤è¯ç³»ç»Ÿå’Œå¼€å‘å·¥å…·é…ç½®ã€‚ç°åœ¨æ˜¯æ—¶å€™å¼€å§‹å®ç°Bluebellç¤¾åŒºè®ºå›çš„æ ¸å¿ƒåŠŸèƒ½äº†!
>
> ç¤¾åŒº(Community)æ˜¯è®ºå›çš„åŸºç¡€ç»„ç»‡å•å…ƒ,å°±åƒRedditçš„subredditã€çŸ¥ä¹çš„è¯é¢˜åœˆå­ã€‚ç”¨æˆ·åœ¨ä¸åŒç¤¾åŒºä¸‹å‘å¸ƒå¸–å­ã€å‚ä¸è®¨è®ºã€‚
>
> æœ¬ç« å°†å®ç°ä¸¤ä¸ªç¤¾åŒºç›¸å…³æ¥å£:**è·å–ç¤¾åŒºåˆ—è¡¨**å’Œ**è·å–ç¤¾åŒºè¯¦æƒ…**,å¸¦ä½ æ·±å…¥ç†è§£RESTful APIè®¾è®¡å’Œä¸‰å±‚æ¶æ„çš„å®é™…åº”ç”¨ã€‚

---

## ğŸ“š æœ¬ç« ç›®æ ‡

å­¦å®Œæœ¬ç« ,ä½ å°†æŒæ¡:

1. ç†è§£ç¤¾åŒº(Community)åœ¨è®ºå›ç³»ç»Ÿä¸­çš„ä½œç”¨
2. è®¾è®¡RESTfulé£æ ¼çš„APIæ¥å£
3. å®ç°ç¤¾åŒºåˆ—è¡¨æŸ¥è¯¢åŠŸèƒ½(Controller â†’ Logic â†’ DAO)
4. å®ç°ç¤¾åŒºè¯¦æƒ…æŸ¥è¯¢åŠŸèƒ½(å¸¦è·¯å¾„å‚æ•°)
5. æŒæ¡è·¯å¾„å‚æ•°çš„è§£æä¸æ ¡éªŒ
6. ç†è§£`sql.ErrNoRows`çš„å¤„ç†ç­–ç•¥
7. åŒºåˆ†ä¸šåŠ¡é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯
8. ç¼–å†™å®Œæ•´çš„Swaggeræ–‡æ¡£æ³¨é‡Š

---

## 1. éœ€æ±‚åˆ†æ

### 1.1 ä»€ä¹ˆæ˜¯ç¤¾åŒº(Community)?

**ç¤¾åŒº**æ˜¯è®ºå›çš„ä¸»é¢˜åˆ†ç±»,ç±»ä¼¼äº:
- Reddit çš„ **subreddit** (`r/golang`, `r/programming`)
- çŸ¥ä¹çš„**è¯é¢˜** (æŠ€æœ¯ã€ç”Ÿæ´»ã€å¨±ä¹)
- è´´å§çš„**å§** (ææ¯…å§ã€é­”å…½å§)

**Bluebellç¤¾åŒºç¤ºä¾‹:**
- Goè¯­è¨€ (`community_id: 1`)
- leetcode (`community_id: 2`)
- æ•°æ®ç»“æ„ä¸ç®—æ³• (`community_id: 3`)
- åŠ¨æ¼« (`community_id: 4`)

### 1.2 åŠŸèƒ½éœ€æ±‚

**éœ€æ±‚1: è·å–ç¤¾åŒºåˆ—è¡¨**
- ç”¨æˆ·è¿›å…¥è®ºå›é¦–é¡µ,éœ€è¦çœ‹åˆ°æ‰€æœ‰å¯ç”¨çš„ç¤¾åŒº
- è¿”å›ç¤¾åŒºIDå’Œåç§°å³å¯(ç®€ç•¥ä¿¡æ¯)
- ç”¨äºå‰ç«¯æ˜¾ç¤ºç­›é€‰å™¨

**éœ€æ±‚2: è·å–ç¤¾åŒºè¯¦æƒ…**
- ç”¨æˆ·ç‚¹å‡»æŸä¸ªç¤¾åŒº,æŸ¥çœ‹è¯¦ç»†ä»‹ç»
- è¿”å›ç¤¾åŒºçš„å®Œæ•´ä¿¡æ¯(IDã€åç§°ã€ç®€ä»‹ã€åˆ›å»ºæ—¶é—´)
- ç”¨äºç¤¾åŒºä¸»é¡µå±•ç¤º

---

## 2. æ•°æ®åº“è®¾è®¡

### 2.1 community è¡¨ç»“æ„

è™½ç„¶é¡¹ç›®ä¸­æ²¡æœ‰SQLæ–‡ä»¶,ä½†æ ¹æ®ä»£ç å¯ä»¥æ¨æ–­è¡¨ç»“æ„:

```sql
CREATE TABLE `community` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢ä¸»é”®',
  `community_id` int(10) unsigned NOT NULL COMMENT 'ç¤¾åŒºID',
  `community_name` varchar(128) NOT NULL COMMENT 'ç¤¾åŒºåç§°',
  `introduction` varchar(256) NOT NULL DEFAULT '' COMMENT 'ç¤¾åŒºä»‹ç»',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_community_id` (`community_id`),
  UNIQUE KEY `idx_community_name` (`community_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='ç¤¾åŒºè¡¨';
```

**å­—æ®µè¯´æ˜:**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡? |
|------|------|------|----------------|
| `id` | int(11) | è‡ªå¢ä¸»é”® | å†…éƒ¨ä½¿ç”¨,ä¿è¯å”¯ä¸€æ€§ |
| `community_id` | int(10) unsigned | ç¤¾åŒºä¸šåŠ¡ID | æš´éœ²ç»™å‰ç«¯,å¯ä»¥æ§åˆ¶IDç”Ÿæˆè§„åˆ™ |
| `community_name` | varchar(128) | ç¤¾åŒºåç§° | å”¯ä¸€ç´¢å¼•,é˜²æ­¢é‡å¤ |
| `introduction` | varchar(256) | ç¤¾åŒºä»‹ç» | ç®€çŸ­æè¿°,é¦–é¡µä¸éœ€è¦åŠ è½½ |
| `create_time` | timestamp | åˆ›å»ºæ—¶é—´ | è®°å½•ç¤¾åŒºå»ºç«‹æ—¶é—´ |
| `update_time` | timestamp | æ›´æ–°æ—¶é—´ | è‡ªåŠ¨æ›´æ–°,æ–¹ä¾¿è¿½è¸ªå˜æ›´ |

**è®¾è®¡è¦ç‚¹:**

**Q1: ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªID(`id`å’Œ`community_id`)?**

A:
- `id`: æ•°æ®åº“è‡ªå¢ä¸»é”®,ä»…å†…éƒ¨ä½¿ç”¨
- `community_id`: ä¸šåŠ¡ID,æš´éœ²ç»™å‰ç«¯
- **å¥½å¤„:**
  - å¯ä»¥è‡ªå®šä¹‰IDç”Ÿæˆè§„åˆ™(å¦‚ä½¿ç”¨Snowflake)
  - æ•°æ®åº“è¿ç§»æ—¶å¯ä»¥ä¿æŒä¸šåŠ¡IDä¸å˜
  - å‰ç«¯çœ‹ä¸åˆ°çœŸå®çš„æ•°æ®åº“ä¸»é”®

**Q2: ä¸ºä»€ä¹ˆ`community_name`éœ€è¦å”¯ä¸€ç´¢å¼•?**

A:
- é˜²æ­¢åˆ›å»ºé‡åç¤¾åŒº
- åŠ é€ŸæŒ‰åç§°æŸ¥è¯¢(`WHERE community_name = ?`)
- ä¿è¯ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§

---

### 2.2 åˆå§‹æ•°æ®

```sql
INSERT INTO `community` VALUES
  ('1', '1', 'Go', 'Golang', '2016-11-01 08:10:10', '2016-11-01 08:10:10'),
  ('2', '2', 'leetcode', 'åˆ·é¢˜åˆ·é¢˜åˆ·é¢˜', '2020-01-01 08:00:00', '2020-01-01 08:00:00'),
  ('3', '3', 'æ•°æ®ç»“æ„ä¸ç®—æ³•', 'æ•°æ®ç»“æ„ä¸ç®—æ³•', '2020-01-01 08:00:00', '2020-01-01 08:00:00'),
  ('4', '4', 'åŠ¨æ¼«', 'äºŒæ¬¡å…ƒä¸€å®¶äº²', '2020-01-01 08:00:00', '2020-01-01 08:00:00');
```

---

## 3. API è®¾è®¡

### 3.1 RESTful è§„èŒƒ

**RESTful** æ˜¯ä¸€ç§APIè®¾è®¡é£æ ¼,æ ¸å¿ƒæ€æƒ³:**èµ„æº + HTTPæ–¹æ³•**

```
èµ„æº(åè¯)      HTTPæ–¹æ³•(åŠ¨è¯)     æ“ä½œ
/community      GET              è·å–ç¤¾åŒºåˆ—è¡¨
/community/:id  GET              è·å–ç¤¾åŒºè¯¦æƒ…
/community      POST             åˆ›å»ºç¤¾åŒº
/community/:id  PUT              æ›´æ–°ç¤¾åŒº
/community/:id  DELETE           åˆ é™¤ç¤¾åŒº
```

**Bluebell ç¤¾åŒºæ¥å£è®¾è®¡:**

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| è·å–ç¤¾åŒºåˆ—è¡¨ | GET | `/api/v1/community` | è¿”å›æ‰€æœ‰ç¤¾åŒº |
| è·å–ç¤¾åŒºè¯¦æƒ… | GET | `/api/v1/community/:id` | è¿”å›æŒ‡å®šç¤¾åŒºè¯¦æƒ… |

---

### 3.2 è¯·æ±‚å’Œå“åº”æ ¼å¼

**æ¥å£1: è·å–ç¤¾åŒºåˆ—è¡¨**

```bash
GET /api/v1/community
Authorization: Bearer <access_token>
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 1000,
  "msg": "success",
  "data": [
    {
      "id": "1",
      "name": "Go"
    },
    {
      "id": "2",
      "name": "leetcode"
    },
    {
      "id": "3",
      "name": "æ•°æ®ç»“æ„ä¸ç®—æ³•"
    },
    {
      "id": "4",
      "name": "åŠ¨æ¼«"
    }
  ]
}
```

**æ³¨æ„:**
- `id` è¿”å›ä¸ºå­—ç¬¦ä¸²(`"1"`)è€Œä¸æ˜¯æ•°å­—(`1`)
- åŸå› :JavaScriptçš„Numberç±»å‹æœ€å¤§å®‰å…¨æ•´æ•°æ˜¯`2^53-1`,Goçš„int64ä¼šè¶…å‡º
- è§£å†³:ä½¿ç”¨`,string` JSONæ ‡ç­¾

---

**æ¥å£2: è·å–ç¤¾åŒºè¯¦æƒ…**

```bash
GET /api/v1/community/1
Authorization: Bearer <access_token>
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 1000,
  "msg": "success",
  "data": {
    "id": "1",
    "name": "Go",
    "introduction": "Golang",
    "create_time": "2016-11-01T08:10:10Z"
  }
}
```

---

## 4. æ•°æ®æ¨¡å‹å®šä¹‰

### 4.1 models/community.go

```go
package models

import "time"

// CommunityDetail ç¤¾åŒºè¯¦æƒ…ç»“æ„ä½“
type CommunityDetail struct {
	ID           int64     `json:"id,string" db:"community_id"`
	Name         string    `json:"name" db:"community_name"`
	Introduction string    `json:"introduction" db:"introduction"`
	CreateTime   time.Time `json:"create_time" db:"create_time"`
}
```

**å­—æ®µè¯´æ˜:**

| å­—æ®µ | ç±»å‹ | JSONæ ‡ç­¾ | DBæ ‡ç­¾ | è¯´æ˜ |
|------|------|----------|--------|------|
| `ID` | int64 | `id,string` | `community_id` | ç¤¾åŒºID,JSONåºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸² |
| `Name` | string | `name` | `community_name` | ç¤¾åŒºåç§° |
| `Introduction` | string | `introduction` | `introduction` | ç¤¾åŒºä»‹ç» |
| `CreateTime` | time.Time | `create_time` | `create_time` | åˆ›å»ºæ—¶é—´ |

---

### 4.2 ,string æ ‡ç­¾è¯¦è§£

**é—®é¢˜:** JavaScriptçš„Numberç±»å‹ç²¾åº¦é—®é¢˜

```javascript
// JavaScript ä¸­
console.log(9007199254740992 === 9007199254740993);  // true (ç²¾åº¦ä¸¢å¤±!)
```

**è§£å†³:** Goçš„int64åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²

```go
// âŒ ä¸åŠ  ,string
type Community struct {
	ID int64 `json:"id"`  // â†’ {"id": 1234567890123456789}
}

// âœ… åŠ  ,string
type Community struct {
	ID int64 `json:"id,string"`  // â†’ {"id": "1234567890123456789"}
}
```

**å‰ç«¯å¤„ç†:**
```javascript
// Vue/React ä¸­ç›´æ¥å½“å­—ç¬¦ä¸²ä½¿ç”¨
const communityId = data.id;  // "1"
axios.get(`/community/${communityId}`);  // /community/1
```

---

## 5. DAOå±‚å®ç°

### 5.1 dao/mysql/community.go

```go
package mysql

import (
	"bluebell/models"
	"bluebell/pkg/errno"
	"database/sql"
	"go.uber.org/zap"
)

var (
	ErrorInvalidID = errno.ErrorInvalidID
)

// GetCommunityList æŸ¥è¯¢ç¤¾åŒºåˆ—è¡¨æ•°æ®
func GetCommunityList() (data []*models.CommunityDetail, err error) {
	sqlStr := "select community_id, community_name from community"

	// åˆå§‹åŒ–åˆ‡ç‰‡,é˜²æ­¢æŸ¥è¯¢ä¸ºç©ºæ—¶è¿”å› nil
	if err = db.Select(&data, sqlStr); err != nil {
		// å¦‚æœæŸ¥è¯¢ä¸ºç©º(sql.ErrNoRows),åœ¨åˆ—è¡¨æŸ¥è¯¢ä¸­é€šå¸¸ä¸è§†ä¸ºé”™è¯¯,è¿”å›ç©ºåˆ—è¡¨å³å¯
		if err == sql.ErrNoRows {
			zap.L().Warn("there is no community in db")
			err = nil
		}
	}
	return
}

// GetCommunityDetailByID æ ¹æ®IDæŸ¥è¯¢æ•°æ®åº“è¯¦æƒ…
func GetCommunityDetailByID(id int64) (community *models.CommunityDetail, err error) {
	community = new(models.CommunityDetail)

	// ç¼–å†™ SQL è¯­å¥
	sqlStr := `select
				community_id, community_name, introduction, create_time
			   from community
			   where community_id = ?`

	// æ‰§è¡ŒæŸ¥è¯¢
	// æ³¨æ„:Get æ–¹æ³•ç”¨äºæŸ¥è¯¢å•æ¡æ•°æ®,å¦‚æœæŸ¥ä¸åˆ°ä¼šè¿”å› error
	err = db.Get(community, sqlStr, id)

	if err != nil {
		// ç‰¹æ®Šå¤„ç†:å¦‚æœæ²¡æœ‰æŸ¥åˆ°æ•°æ®
		if err == sql.ErrNoRows {
			zap.L().Warn("there is no community in db", zap.Int64("community_id", id))
			return nil, nil // è¿”å›nilè€Œä¸æ˜¯error,è®©ä¸Šå±‚å†³å®šå¦‚ä½•å¤„ç†
		}
		// å…¶ä»–æ•°æ®åº“é”™è¯¯(å¦‚è¿æ¥æ–­å¼€ã€SQLè¯­æ³•é”™è¯¯ç­‰)
		zap.L().Error("query community detail failed", zap.Error(err))
		return nil, err
	}
	return
}
```

---

### 5.2 æ ¸å¿ƒè¦ç‚¹è§£æ

#### 5.2.1 db.Select vs db.Get

| æ–¹æ³• | ç”¨é€” | è¿”å›å€¼ | ErrNoRows |
|------|------|--------|-----------|
| `db.Select(&slice, sql, args...)` | æŸ¥è¯¢å¤šè¡Œæ•°æ® | `[]T` | **ä¸è¿”å›**ErrNoRows(è¿”å›ç©ºåˆ‡ç‰‡) |
| `db.Get(&struct, sql, args...)` | æŸ¥è¯¢å•è¡Œæ•°æ® | `T` | **è¿”å›**ErrNoRows |

**ç¤ºä¾‹:**
```go
// Select: æŸ¥è¯¢0è¡Œä¸æŠ¥é”™
var communities []*models.Community
err := db.Select(&communities, "SELECT * FROM community WHERE id > 1000")
// err = nil, communities = []  â† ç©ºåˆ‡ç‰‡

// Get: æŸ¥è¯¢0è¡ŒæŠ¥é”™
var community models.Community
err := db.Get(&community, "SELECT * FROM community WHERE id = 9999")
// err = sql.ErrNoRows  â† éœ€è¦å¤„ç†
```

---

#### 5.2.2 sql.ErrNoRows å¤„ç†ç­–ç•¥

**åœºæ™¯1: åˆ—è¡¨æŸ¥è¯¢(GetCommunityList)**

```go
if err == sql.ErrNoRows {
    zap.L().Warn("there is no community in db")
    err = nil  // â† ä¸è§†ä¸ºé”™è¯¯,è¿”å›ç©ºåˆ—è¡¨
}
```

**ç†ç”±:**
- åˆ—è¡¨ä¸ºç©ºæ˜¯æ­£å¸¸æƒ…å†µ(å¦‚åˆå§‹åŒ–çŠ¶æ€)
- å‰ç«¯æœŸæœ›å¾—åˆ°`{"code": 1000, "data": []}`è€Œä¸æ˜¯é”™è¯¯

---

**åœºæ™¯2: è¯¦æƒ…æŸ¥è¯¢(GetCommunityDetailByID)**

```go
if err == sql.ErrNoRows {
    zap.L().Warn("there is no community in db", zap.Int64("community_id", id))
    return nil, nil  // â† è¿”å›nil,ä¸è¿”å›error
}
```

**ç†ç”±:**
- æŸ¥ä¸åˆ°æ•°æ®å¯èƒ½æ˜¯ä¸šåŠ¡é”™è¯¯(æ— æ•ˆID),ä¹Ÿå¯èƒ½æ˜¯æ•°æ®è¢«åˆ é™¤
- è®©ä¸Šå±‚(Logicå±‚)å†³å®šå¦‚ä½•å¤„ç†
- å¦‚æœç›´æ¥è¿”å›error,ä¸Šå±‚æ— æ³•åŒºåˆ†"æ•°æ®ä¸å­˜åœ¨"å’Œ"æ•°æ®åº“æ•…éšœ"

**å¯¹æ¯”:**
```go
// âŒ ä¸å¥½çš„åšæ³•
if err == sql.ErrNoRows {
    return nil, err  // ä¸Šå±‚æ— æ³•åŒºåˆ†é”™è¯¯ç±»å‹
}

// âœ… å¥½çš„åšæ³•
if err == sql.ErrNoRows {
    return nil, nil  // ä¸Šå±‚å¯ä»¥åˆ¤æ–­ data == nil æ¥åŒºåˆ†
}
```

---

#### 5.2.3 ä¸ºä»€ä¹ˆåˆ—è¡¨åªè¿”å›éƒ¨åˆ†å­—æ®µ?

```go
sqlStr := "select community_id, community_name from community"
```

**åŸå› :**
1. **æ€§èƒ½ä¼˜åŒ–**: ä¸éœ€è¦çš„å­—æ®µä¸æŸ¥è¯¢(å¦‚`introduction`å¾ˆé•¿)
2. **å‰ç«¯éœ€æ±‚**: åˆ—è¡¨é¡µåªéœ€è¦IDå’Œåç§°
3. **å‡å°‘æµé‡**: è¿”å›çš„JSONæ›´å°

**å¯¹æ¯”:**
```sql
-- âŒ æŸ¥è¯¢æ‰€æœ‰å­—æ®µ(æµªè´¹)
SELECT * FROM community;

-- âœ… åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
SELECT community_id, community_name FROM community;
```

---

## 6. Logicå±‚å®ç°

### 6.1 logic/community.go

```go
package logic

import (
	"bluebell/dao/mysql"
	"bluebell/models"
	"bluebell/pkg/errno"
)

// GetCommunityList è·å–ç¤¾åŒºåˆ—è¡¨
func GetCommunityList() ([]*models.CommunityDetail, error) {
	// ç›´æ¥è°ƒç”¨ DAO å±‚çš„æ–¹æ³•
	// å°†æ¥å¦‚æœæœ‰å¤æ‚çš„ä¸šåŠ¡é€»è¾‘(æ¯”å¦‚ç¼“å­˜ã€æ•°æ®æ‹¼æ¥)å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ 
	return mysql.GetCommunityList()
}

// GetCommunityDetail æ ¹æ®IDè·å–ç¤¾åŒºè¯¦æƒ…
func GetCommunityDetail(id int64) (*models.CommunityDetail, error) {
	// ç›´æ¥è°ƒç”¨ DAO å±‚æŸ¥è¯¢æ•°æ®åº“
	data, err := mysql.GetCommunityDetailByID(id)
	// å¦‚æœæœ‰è‡ªå®šä¹‰çš„æ— æ•ˆIDé”™è¯¯,åˆ™å‘ä¸Šä¼ é€’
	if err != nil {
		// åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯
		if err == errno.ErrorInvalidID {
			return nil, errno.ErrorInvalidID
		}
		// å…¶ä»–æƒ…å†µè§†ä¸ºæŸ¥è¯¢å¤±è´¥
		return nil, errno.ErrorQueryFailed
	}
	return data, nil
}
```

---

### 6.2 Logicå±‚çš„èŒè´£

**å½“å‰é˜¶æ®µ:** Logicå±‚çœ‹èµ·æ¥åªæ˜¯ç®€å•è½¬å‘

**æœªæ¥æ‰©å±•:**
```go
func GetCommunityList() ([]*models.CommunityDetail, error) {
	// 1. å°è¯•ä»ç¼“å­˜è·å–
	cached, err := redis.GetCommunityListCache()
	if err == nil {
		return cached, nil
	}

	// 2. ç¼“å­˜æœªå‘½ä¸­,æŸ¥è¯¢æ•°æ®åº“
	data, err := mysql.GetCommunityList()
	if err != nil {
		return nil, err
	}

	// 3. æ•°æ®æ‹¼æ¥(å¦‚ç»Ÿè®¡æ¯ä¸ªç¤¾åŒºçš„å¸–å­æ•°)
	for _, community := range data {
		count, _ := mysql.GetPostCountByCommunityID(community.ID)
		community.PostCount = count
	}

	// 4. å†™å…¥ç¼“å­˜
	redis.SetCommunityListCache(data, 5*time.Minute)

	return data, nil
}
```

**èŒè´£æ€»ç»“:**

| å±‚çº§ | èŒè´£ | ç¤ºä¾‹ |
|------|------|------|
| DAO | æ•°æ®è®¿é—® | æ‰§è¡ŒSQL,æ“ä½œRedis |
| **Logic** | **ä¸šåŠ¡é€»è¾‘** | ç¼“å­˜ç­–ç•¥ã€æ•°æ®æ‹¼æ¥ã€æƒé™æ ¡éªŒ |
| Controller | è¯·æ±‚å¤„ç† | å‚æ•°è§£æã€å“åº”å°è£… |

---

## 7. Controllerå±‚å®ç°

### 7.1 controller/community.go

```go
package controller

import (
	"errors"
	"strconv"

	"bluebell/logic"
	"bluebell/pkg/errno"
	"github.com/gin-gonic/gin"
	"go.uber.org/zap"
)

// CommunityHandler è·å–ç¤¾åŒºåˆ—è¡¨
// @Summary è·å–ç¤¾åŒºåˆ—è¡¨
// @Description è·å–æ‰€æœ‰ç¤¾åŒºçš„åˆ—è¡¨ä¿¡æ¯
// @Tags ç¤¾åŒºç›¸å…³
// @Accept application/json
// @Produce application/json
// @Param Authorization header string true "Bearer ç”¨æˆ·ä»¤ç‰Œ"
// @Success 200 {object} ResponseData{data=[]models.CommunityDetail}
// @Router /community [get]
// @Security ApiKeyAuth
func CommunityHandler(c *gin.Context) {
	// 1. æŸ¥è¯¢æ‰€æœ‰çš„ç¤¾åŒº (community_id, community_name) ä»¥åˆ—è¡¨çš„å½¢å¼è¿”å›
	data, err := logic.GetCommunityList()
	if err != nil {
		zap.L().Error("logic.GetCommunityList() failed", zap.Error(err))
		ResponseError(c, CodeServerBusy) // ç»Ÿä¸€çš„é”™è¯¯å“åº”å°è£…
		return
	}

	// 2. è¿”å›æˆåŠŸå“åº”
	ResponseSuccess(c, data)
}

// CommunityDetailHandler è·å–ç¤¾åŒºè¯¦æƒ…
// @Summary è·å–ç¤¾åŒºè¯¦æƒ…
// @Description æ ¹æ®ç¤¾åŒºIDè·å–ç¤¾åŒºçš„è¯¦ç»†ä¿¡æ¯
// @Tags ç¤¾åŒºç›¸å…³
// @Accept application/json
// @Produce application/json
// @Param id path int true "ç¤¾åŒºID"
// @Param Authorization header string true "Bearer ç”¨æˆ·ä»¤ç‰Œ"
// @Success 200 {object} ResponseData{data=models.CommunityDetail}
// @Failure 400 {object} ResponseData
// @Failure 500 {object} ResponseData
// @Router /community/{id} [get]
// @Security ApiKeyAuth
func CommunityDetailHandler(c *gin.Context) {
	// 1. è·å–è·¯å¾„å‚æ•° (community_id)
	idStr := c.Param("id")

	// 2. å‚æ•°ç±»å‹è½¬æ¢ (String -> Int64)
	id, err := strconv.ParseInt(idStr, 10, 64)
	if err != nil {
		// å¦‚æœè½¬æ¢å¤±è´¥,è¯´æ˜å‰ç«¯ä¼ æ¥çš„ä¸æ˜¯æ•°å­—,è¿”å›å‚æ•°é”™è¯¯
		ResponseError(c, CodeInvalidParam)
		return
	}

	// 3. è°ƒç”¨ Logic å±‚è·å–è¯¦æƒ…
	data, err := logic.GetCommunityDetail(id)
	if err != nil {
		zap.L().Error("logic.GetCommunityDetail() failed", zap.Error(err))
		// æ ¹æ® error ç±»å‹è¿”å›ä¸åŒçš„é”™è¯¯ç 
		if errors.Is(err, errno.ErrorInvalidID) {
			ResponseError(c, CodeInvalidParam) // æ— æ•ˆIDè¿”å›å‚æ•°é”™è¯¯
		} else {
			ResponseError(c, CodeServerBusy) // å…¶ä»–é”™è¯¯è¿”å›æœåŠ¡ç¹å¿™
		}
		return
	}

	// 4. è¿”å›æˆåŠŸå“åº”
	ResponseSuccess(c, data)
}
```

---

### 7.2 æ ¸å¿ƒè¦ç‚¹è§£æ

#### 7.2.1 è·¯å¾„å‚æ•°è§£æ

**Ginè·¯å¾„å‚æ•°è¯­æ³•:**
```go
// è·¯ç”±å®šä¹‰
r.GET("/community/:id", CommunityDetailHandler)

// å‚æ•°è·å–
idStr := c.Param("id")  // è·å–è·¯å¾„ä¸­çš„ :id
```

**å®Œæ•´ç¤ºä¾‹:**
```go
// è¯·æ±‚: GET /api/v1/community/123
idStr := c.Param("id")  // idStr = "123"

// è¯·æ±‚: GET /api/v1/community/abc
idStr := c.Param("id")  // idStr = "abc" (éœ€è¦æ ¡éªŒ!)
```

---

#### 7.2.2 strconv.ParseInt è¯¦è§£

```go
id, err := strconv.ParseInt(idStr, 10, 64)
```

**å‚æ•°è¯´æ˜:**
- `idStr`: è¦è½¬æ¢çš„å­—ç¬¦ä¸²
- `10`: è¿›åˆ¶(10è¿›åˆ¶)
- `64`: è¿”å›å€¼ä½æ•°(int64)

**è¿”å›å€¼:**
- `id`: è½¬æ¢åçš„int64
- `err`: è½¬æ¢é”™è¯¯(å¦‚æœè¾“å…¥ä¸æ˜¯æ•°å­—)

**æµ‹è¯•ç”¨ä¾‹:**
```go
// âœ… æˆåŠŸ
strconv.ParseInt("123", 10, 64)    // 123, nil
strconv.ParseInt("0", 10, 64)      // 0, nil
strconv.ParseInt("-456", 10, 64)   // -456, nil

// âŒ å¤±è´¥
strconv.ParseInt("abc", 10, 64)    // 0, error
strconv.ParseInt("12.34", 10, 64)  // 0, error
strconv.ParseInt("", 10, 64)       // 0, error
```

---

#### 7.2.3 é”™è¯¯å¤„ç†ç­–ç•¥

**åŒºåˆ†ä¸¤ç±»é”™è¯¯:**

**1. å‚æ•°é”™è¯¯ (400 Bad Request)**
```go
if err != nil {
	// è½¬æ¢å¤±è´¥ â†’ å‚æ•°æ ¼å¼é”™è¯¯
	ResponseError(c, CodeInvalidParam)
	return
}

if errors.Is(err, errno.ErrorInvalidID) {
	// ä¸šåŠ¡é”™è¯¯ â†’ ç¤¾åŒºIDä¸å­˜åœ¨
	ResponseError(c, CodeInvalidParam)
	return
}
```

**2. ç³»ç»Ÿé”™è¯¯ (500 Server Busy)**
```go
if err != nil {
	// æ•°æ®åº“è¿æ¥å¤±è´¥ã€SQLè¯­æ³•é”™è¯¯ç­‰
	ResponseError(c, CodeServerBusy)
	return
}
```

---

## 8. è·¯ç”±æ³¨å†Œ

### 8.1 routers/routers.go

```go
func SetupRouter(mode string) *gin.Engine {
	// ...

	authGroup := r.Group("/api/v1")
	authGroup.Use(middlewares.JWTAuthMiddleware())
	{
		// ç¤¾åŒºç›¸å…³è·¯ç”±
		authGroup.GET("/community", controller.CommunityHandler)          // è·å–ç¤¾åŒºåˆ—è¡¨
		authGroup.GET("/community/:id", controller.CommunityDetailHandler) // è·å–ç¤¾åŒºè¯¦æƒ…

		// å…¶ä»–è·¯ç”±...
	}

	return r
}
```

**è·¯ç”±è§£æ:**
```
GET /api/v1/community       â†’ CommunityHandler
GET /api/v1/community/1     â†’ CommunityDetailHandler (id=1)
GET /api/v1/community/123   â†’ CommunityDetailHandler (id=123)
GET /api/v1/community/abc   â†’ CommunityDetailHandler (id=abc, å‚æ•°é”™è¯¯)
```

---

## 9. æ¥å£æµ‹è¯•

### 9.1 ä½¿ç”¨curlæµ‹è¯•

**æ­¥éª¤1: ç™»å½•è·å–Token**
```bash
curl -X POST http://localhost:8080/api/v1/login \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "123456"}'

# å“åº”:
{
  "code": 1000,
  "msg": "success",
  "data": {
    "access_token": "eyJhbGc...",
    "refresh_token": "eyJhbGc..."
  }
}
```

---

**æ­¥éª¤2: è·å–ç¤¾åŒºåˆ—è¡¨**
```bash
curl -X GET http://localhost:8080/api/v1/community \
  -H "Authorization: Bearer eyJhbGc..."

# å“åº”:
{
  "code": 1000,
  "msg": "success",
  "data": [
    {"id": "1", "name": "Go"},
    {"id": "2", "name": "leetcode"},
    {"id": "3", "name": "æ•°æ®ç»“æ„ä¸ç®—æ³•"},
    {"id": "4", "name": "åŠ¨æ¼«"}
  ]
}
```

---

**æ­¥éª¤3: è·å–ç¤¾åŒºè¯¦æƒ…**
```bash
curl -X GET http://localhost:8080/api/v1/community/1 \
  -H "Authorization: Bearer eyJhbGc..."

# å“åº”:
{
  "code": 1000,
  "msg": "success",
  "data": {
    "id": "1",
    "name": "Go",
    "introduction": "Golang",
    "create_time": "2016-11-01T08:10:10Z"
  }
}
```

---

**æ­¥éª¤4: æµ‹è¯•é”™è¯¯æƒ…å†µ**

**æµ‹è¯•æ— æ•ˆID:**
```bash
curl -X GET http://localhost:8080/api/v1/community/abc \
  -H "Authorization: Bearer eyJhbGc..."

# å“åº”:
{
  "code": 1007,
  "msg": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "data": null
}
```

**æµ‹è¯•ä¸å­˜åœ¨çš„ID:**
```bash
curl -X GET http://localhost:8080/api/v1/community/9999 \
  -H "Authorization: Bearer eyJhbGc..."

# å“åº”:
{
  "code": 1007,
  "msg": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "data": null
}
```

---

### 9.2 ä½¿ç”¨Swagger UIæµ‹è¯•

**æ­¥éª¤1: å¯åŠ¨æœåŠ¡**
```bash
make dev  # æˆ– air
```

**æ­¥éª¤2: è®¿é—®Swagger**
```
http://localhost:8080/swagger/index.html
```

**æ­¥éª¤3: è®¤è¯**
1. ç‚¹å‡»å³ä¸Šè§’ ğŸ”’ "Authorize"
2. è¾“å…¥: `Bearer <access_token>`
3. ç‚¹å‡» "Authorize"

**æ­¥éª¤4: æµ‹è¯•æ¥å£**
1. å±•å¼€ `GET /api/v1/community`
2. ç‚¹å‡» "Try it out"
3. ç‚¹å‡» "Execute"
4. æŸ¥çœ‹å“åº”

---

## 10. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 10.1 è¿”å›æ•°æ®ä¸ºnull

**é—®é¢˜:**
```json
{
  "code": 1000,
  "msg": "success",
  "data": null  â† ä¸ºä»€ä¹ˆæ˜¯null?
}
```

**åŸå› 1:** æ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ®

**è§£å†³:** æ‰§è¡Œåˆå§‹åŒ–SQL
```sql
INSERT INTO `community` VALUES
  ('1', '1', 'Go', 'Golang', NOW(), NOW());
```

---

**åŸå› 2:** ç»“æ„ä½“æ ‡ç­¾é”™è¯¯

```go
// âŒ é”™è¯¯
type Community struct {
	ID   int64  `json:"id" db:"id"`  // dbæ ‡ç­¾é”™è¯¯
	Name string `json:"name" db:"name"`
}

// âœ… æ­£ç¡®
type Community struct {
	ID   int64  `json:"id" db:"community_id"`  // å¯¹åº”æ•°æ®åº“å­—æ®µå
	Name string `json:"name" db:"community_name"`
}
```

---

### 10.2 è·¯å¾„å‚æ•°è·å–å¤±è´¥

**é—®é¢˜:** `c.Param("id")` è¿”å›ç©ºå­—ç¬¦ä¸²

**åŸå› :** è·¯ç”±å®šä¹‰é”™è¯¯

```go
// âŒ é”™è¯¯
r.GET("/community/id", handler)  // æ²¡æœ‰ :

// âœ… æ­£ç¡®
r.GET("/community/:id", handler)  // æœ‰ :
```

---

### 10.3 Tokenè®¤è¯å¤±è´¥

**é—®é¢˜:** è¿”å›401æˆ–1004é”™è¯¯

**åŸå› 1:** å¿˜è®°æºå¸¦Token

**è§£å†³:**
```bash
# âŒ é”™è¯¯
curl http://localhost:8080/api/v1/community

# âœ… æ­£ç¡®
curl -H "Authorization: Bearer <token>" http://localhost:8080/api/v1/community
```

---

**åŸå› 2:** Tokenæ ¼å¼é”™è¯¯

```bash
# âŒ é”™è¯¯
Authorization: eyJhbGc...  # å°‘äº† Bearer

# âœ… æ­£ç¡®
Authorization: Bearer eyJhbGc...
```

---

### 10.4 Swaggeræ³¨é‡Šä¸ç”Ÿæ•ˆ

**é—®é¢˜:** Swagger UIä¸­çœ‹ä¸åˆ°æ–°æ¥å£

**åŸå› :** å¿˜è®°è¿è¡Œ `swag init`

**è§£å†³:**
```bash
swag init
# æˆ–
make swag

# é‡å¯æœåŠ¡
make dev
```

---

## 11. æœ€ä½³å®è·µ

### 11.1 å‚æ•°æ ¡éªŒ

**åœ¨Controllerå±‚æ ¡éªŒå‚æ•°:**
```go
func CommunityDetailHandler(c *gin.Context) {
	idStr := c.Param("id")

	// 1. æ£€æŸ¥å‚æ•°æ˜¯å¦ä¸ºç©º
	if idStr == "" {
		ResponseError(c, CodeInvalidParam)
		return
	}

	// 2. ç±»å‹è½¬æ¢
	id, err := strconv.ParseInt(idStr, 10, 64)
	if err != nil {
		ResponseError(c, CodeInvalidParam)
		return
	}

	// 3. èŒƒå›´æ ¡éªŒ
	if id <= 0 {
		ResponseError(c, CodeInvalidParam)
		return
	}

	// ç»§ç»­ä¸šåŠ¡é€»è¾‘...
}
```

---

### 11.2 é”™è¯¯æ—¥å¿—è®°å½•

**è®°å½•å¿…è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯:**
```go
if err != nil {
	zap.L().Error("logic.GetCommunityDetail() failed",
		zap.Error(err),
		zap.Int64("community_id", id),  // è®°å½•è¯·æ±‚å‚æ•°
		zap.String("user_id", userID))   // è®°å½•ç”¨æˆ·ID
	ResponseError(c, CodeServerBusy)
	return
}
```

---

### 11.3 RESTfulè§„èŒƒ

**éµå¾ªç»Ÿä¸€çš„è·¯å¾„é£æ ¼:**
```go
// âœ… æ¨è
GET    /api/v1/community         // è·å–åˆ—è¡¨
GET    /api/v1/community/:id     // è·å–è¯¦æƒ…
POST   /api/v1/community         // åˆ›å»º
PUT    /api/v1/community/:id     // æ›´æ–°
DELETE /api/v1/community/:id     // åˆ é™¤

// âŒ ä¸æ¨è
GET /api/v1/getCommunityList       // åŠ¨è¯æ”¾åœ¨è·¯å¾„ä¸­
GET /api/v1/communityDetail?id=1   // ç”¨queryå‚æ•°ä»£æ›¿è·¯å¾„å‚æ•°
```

---

## 12. å®æˆ˜ç»ƒä¹ 

### ç»ƒä¹ 1: æ·»åŠ ç¤¾åŒºç»Ÿè®¡ä¿¡æ¯

**ä»»åŠ¡:** åœ¨ç¤¾åŒºåˆ—è¡¨ä¸­æ·»åŠ å¸–å­æ•°é‡ç»Ÿè®¡

**è¦æ±‚:**
1. ä¿®æ”¹`CommunityDetail`ç»“æ„ä½“,æ·»åŠ `PostCount`å­—æ®µ
2. åœ¨Logicå±‚æŸ¥è¯¢æ¯ä¸ªç¤¾åŒºçš„å¸–å­æ•°
3. è¿”å›æ ¼å¼:
```json
{
  "id": "1",
  "name": "Go",
  "post_count": 42
}
```

**æç¤º:**
```go
// dao/mysql/community.go
func GetPostCountByCommunityID(communityID int64) (int64, error) {
	var count int64
	sqlStr := "SELECT COUNT(*) FROM post WHERE community_id = ?"
	err := db.Get(&count, sqlStr, communityID)
	return count, err
}

// logic/community.go
func GetCommunityList() ([]*models.CommunityDetail, error) {
	data, err := mysql.GetCommunityList()
	if err != nil {
		return nil, err
	}

	// ä¸ºæ¯ä¸ªç¤¾åŒºæ·»åŠ å¸–å­æ•°
	for _, community := range data {
		count, _ := mysql.GetPostCountByCommunityID(community.ID)
		community.PostCount = count
	}

	return data, nil
}
```

---

### ç»ƒä¹ 2: å®ç°ç¤¾åŒºæœç´¢åŠŸèƒ½

**ä»»åŠ¡:** æ·»åŠ æŒ‰åç§°æœç´¢ç¤¾åŒºçš„åŠŸèƒ½

**æ¥å£è®¾è®¡:**
```
GET /api/v1/community/search?keyword=go
```

**å‚è€ƒç­”æ¡ˆ:**
```go
// dao/mysql/community.go
func SearchCommunities(keyword string) ([]*models.CommunityDetail, error) {
	var data []*models.CommunityDetail
	sqlStr := `SELECT community_id, community_name
	           FROM community
	           WHERE community_name LIKE ?`
	err := db.Select(&data, sqlStr, "%"+keyword+"%")
	return data, err
}

// controller/community.go
func CommunitySearchHandler(c *gin.Context) {
	keyword := c.Query("keyword")
	if keyword == "" {
		ResponseError(c, CodeInvalidParam)
		return
	}

	data, err := logic.SearchCommunities(keyword)
	if err != nil {
		zap.L().Error("logic.SearchCommunities() failed", zap.Error(err))
		ResponseError(c, CodeServerBusy)
		return
	}

	ResponseSuccess(c, data)
}
```

---

### ç»ƒä¹ 3: æ·»åŠ ç¼“å­˜ä¼˜åŒ–

**ä»»åŠ¡:** ä½¿ç”¨Redisç¼“å­˜ç¤¾åŒºåˆ—è¡¨,å‡å°‘æ•°æ®åº“æŸ¥è¯¢

**è¦æ±‚:**
1. ç¤¾åŒºåˆ—è¡¨ç¼“å­˜5åˆ†é’Ÿ
2. ç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“
3. æŸ¥è¯¢æ•°æ®åº“åå†™å…¥ç¼“å­˜

**å‚è€ƒç­”æ¡ˆ:**
```go
// dao/redis/community.go
func GetCommunityListCache() ([]*models.CommunityDetail, error) {
	key := "bluebell:community:list"
	data, err := rdb.Get(ctx, key).Result()
	if err != nil {
		return nil, err
	}

	var communities []*models.CommunityDetail
	err = json.Unmarshal([]byte(data), &communities)
	return communities, err
}

func SetCommunityListCache(data []*models.CommunityDetail) error {
	key := "bluebell:community:list"
	jsonData, err := json.Marshal(data)
	if err != nil {
		return err
	}
	return rdb.Set(ctx, key, jsonData, 5*time.Minute).Err()
}

// logic/community.go
func GetCommunityList() ([]*models.CommunityDetail, error) {
	// 1. å°è¯•ä»ç¼“å­˜è·å–
	data, err := redis.GetCommunityListCache()
	if err == nil {
		return data, nil
	}

	// 2. ç¼“å­˜æœªå‘½ä¸­,æŸ¥è¯¢æ•°æ®åº“
	data, err = mysql.GetCommunityList()
	if err != nil {
		return nil, err
	}

	// 3. å†™å…¥ç¼“å­˜
	go redis.SetCommunityListCache(data)  // å¼‚æ­¥å†™å…¥

	return data, nil
}
```

---

## 13. æœ¬ç« æ€»ç»“

### 13.1 æ ¸å¿ƒçŸ¥è¯†ç‚¹

| çŸ¥è¯†ç‚¹ | è¯´æ˜ |
|--------|------|
| **RESTful API** | èµ„æº+HTTPæ–¹æ³•,`/community`è¡¨ç¤ºç¤¾åŒºèµ„æº |
| **è·¯å¾„å‚æ•°** | `/community/:id`,é€šè¿‡`c.Param("id")`è·å– |
| **ä¸‰å±‚æ¶æ„** | Controller â†’ Logic â†’ DAO,èŒè´£æ˜ç¡® |
| **sql.ErrNoRows** | åˆ—è¡¨æŸ¥è¯¢å¿½ç•¥,è¯¦æƒ…æŸ¥è¯¢è¿”å›nil |
| **,stringæ ‡ç­¾** | è§£å†³JavaScriptå¤§æ•°å­—ç²¾åº¦é—®é¢˜ |
| **é”™è¯¯åŒºåˆ†** | å‚æ•°é”™è¯¯(400) vs ç³»ç»Ÿé”™è¯¯(500) |
| **Swaggeræ³¨é‡Š** | `@Param id path int true`,è·¯å¾„å‚æ•°ç”¨`path` |

### 13.2 æ•°æ®æµè½¬

```
HTTPè¯·æ±‚ â†’ Ginè·¯ç”±
           â†“
      Controller (å‚æ•°è§£æã€ç±»å‹è½¬æ¢)
           â†“
      Logic (ä¸šåŠ¡é€»è¾‘ã€æœªæ¥åŠ ç¼“å­˜)
           â†“
      DAO (SQLæŸ¥è¯¢)
           â†“
      MySQLæ•°æ®åº“
```

### 13.3 ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡?

**Q: ä¸ºä»€ä¹ˆä¸åœ¨DAOå±‚ç›´æ¥è¿”å›error?**

A: ä¸ºäº†è®©Logicå±‚èƒ½åŒºåˆ†"æ•°æ®ä¸å­˜åœ¨"å’Œ"æ•°æ®åº“æ•…éšœ"ä¸¤ç§æƒ…å†µ,é‡‡ç”¨ä¸åŒçš„å¤„ç†ç­–ç•¥ã€‚

---

**Q: ä¸ºä»€ä¹ˆåˆ—è¡¨å’Œè¯¦æƒ…ç”¨åŒä¸€ä¸ªç»“æ„ä½“?**

A: è™½ç„¶åˆ—è¡¨åªè¿”å›éƒ¨åˆ†å­—æ®µ,ä½†ä½¿ç”¨åŒä¸€ä¸ªç»“æ„ä½“æ›´çµæ´»ã€‚JSONåºåˆ—åŒ–æ—¶,æœªèµ‹å€¼çš„å­—æ®µè‡ªåŠ¨è¢«å¿½ç•¥ã€‚

---

**Q: ä¸ºä»€ä¹ˆéœ€è¦Logicå±‚?**

A: å½“å‰è™½ç„¶ç®€å•,ä½†æœªæ¥ä¼šåŠ å…¥ç¼“å­˜ã€æ•°æ®æ‹¼æ¥ã€æƒé™æ ¡éªŒç­‰å¤æ‚é€»è¾‘,Logicå±‚æ˜¯æ‰©å±•çš„åŸºç¡€ã€‚

---

## 14. å»¶ä¼¸é˜…è¯»

### 14.1 ç›¸å…³æ–‡æ¡£

- [RESTful API è®¾è®¡è§„èŒƒ](https://restfulapi.net/)
- [Gin è·¯ç”±å‚æ•°è§£æ](https://gin-gonic.com/docs/examples/param-in-path/)
- [sqlx æ–‡æ¡£](http://jmoiron.github.io/sqlx/)

### 14.2 è¿›é˜¶è¯é¢˜

- **åˆ†é¡µæŸ¥è¯¢**: `LIMIT OFFSET`çš„æ€§èƒ½é—®é¢˜å’Œä¼˜åŒ–æ–¹æ¡ˆ
- **ç¼“å­˜ç­–ç•¥**: Cache-Asideã€Read-Throughã€Write-Through
- **APIç‰ˆæœ¬ç®¡ç†**: `/api/v1`ã€`/api/v2`çš„å¹³æ»‘è¿ç§»
- **GraphQL**: RESTfulçš„æ›¿ä»£æ–¹æ¡ˆ

---

## 15. å¸¸è§é¢è¯•é¢˜

**Q1: RESTfulä¸­GETå’ŒPOSTçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?**

**A:**
- **è¯­ä¹‰:** GETç”¨äºæŸ¥è¯¢,POSTç”¨äºåˆ›å»º
- **å¹‚ç­‰æ€§:** GETæ˜¯å¹‚ç­‰çš„(å¤šæ¬¡è¯·æ±‚ç»“æœç›¸åŒ),POSTä¸æ˜¯
- **ç¼“å­˜:** GETå¯ä»¥è¢«ç¼“å­˜,POSTä¸èƒ½
- **å‚æ•°:** GETå‚æ•°åœ¨URLä¸­,POSTåœ¨Bodyä¸­

---

**Q2: ä¸ºä»€ä¹ˆç¤¾åŒºIDè¦ç”¨,stringæ ‡ç­¾?**

**A:** JavaScriptçš„Numberç±»å‹æœ€å¤§å®‰å…¨æ•´æ•°æ˜¯`2^53-1 = 9007199254740991`,Goçš„int64æœ€å¤§å€¼æ˜¯`2^63-1 = 9223372036854775807`,ä¼šå¯¼è‡´ç²¾åº¦ä¸¢å¤±ã€‚ä½¿ç”¨`,string`å°†int64åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²é¿å…æ­¤é—®é¢˜ã€‚

---

**Q3: sql.ErrNoRowsä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘?**

**A:** ä½¿ç”¨`db.Get()`æŸ¥è¯¢å•è¡Œæ•°æ®æ—¶,å¦‚æœæŸ¥è¯¢ç»“æœä¸ºç©º,ä¼šè¿”å›`sql.ErrNoRows`ã€‚ä½†`db.Select()`æŸ¥è¯¢å¤šè¡Œæ—¶,ç»“æœä¸ºç©ºä¸ä¼šè¿”å›æ­¤é”™è¯¯,è€Œæ˜¯è¿”å›ç©ºåˆ‡ç‰‡ã€‚

---

**Q4: ä¸‰å±‚æ¶æ„ä¸­,ä¸šåŠ¡é€»è¾‘åº”è¯¥æ”¾åœ¨å“ªä¸€å±‚?**

**A:** **Logicå±‚**ã€‚Controllerå±‚åªè´Ÿè´£å‚æ•°è§£æå’Œå“åº”å°è£…,DAOå±‚åªè´Ÿè´£æ•°æ®è®¿é—®,ä¸šåŠ¡é€»è¾‘(å¦‚ç¼“å­˜ç­–ç•¥ã€æƒé™æ ¡éªŒã€æ•°æ®æ‹¼æ¥)éƒ½åº”è¯¥åœ¨Logicå±‚å®ç°ã€‚

---

**Q5: å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„RESTful API?**

**A:**
1. **åè¯åŒ–:** ä½¿ç”¨èµ„æºåè¯è€ŒéåŠ¨è¯(`/users`è€Œé`/getUsers`)
2. **HTTPæ–¹æ³•:** åˆ©ç”¨GET/POST/PUT/DELETEè¡¨ç¤ºæ“ä½œ
3. **ç‰ˆæœ¬æ§åˆ¶:** ä½¿ç”¨`/api/v1`å‰ç¼€
4. **ç»Ÿä¸€å“åº”:** ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼(code, msg, data)
5. **é”™è¯¯å¤„ç†:** åŒºåˆ†ä¸šåŠ¡é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯
6. **æ–‡æ¡£å®Œå–„:** æä¾›Swaggerç­‰æ–‡æ¡£

---

## ğŸ“– ä¸‹ä¸€ç« é¢„å‘Š

æˆ‘ä»¬å·²ç»å®ç°äº†ç¤¾åŒºçš„æŸ¥è¯¢åŠŸèƒ½,ä½†è®ºå›çš„æ ¸å¿ƒæ˜¯**å¸–å­(Post)**!

ä¸‹ä¸€ç« ,æˆ‘ä»¬å°†å­¦ä¹ :
- å¸–å­è¡¨è®¾è®¡ä¸å†…å­˜å¯¹é½ä¼˜åŒ–
- åˆ›å»ºå¸–å­æ¥å£å®ç°
- å¤šè¡¨å…³è”æŸ¥è¯¢
- ä»Contextä¸­è·å–å½“å‰ç”¨æˆ·ID

è®©ç¤¾åŒºæ´»è·ƒèµ·æ¥! ğŸš€

---

**ğŸ“– ä¸‹ä¸€ç« : [ç¬¬14ç« :å¸–å­å‘å¸ƒåŠŸèƒ½å®ç°](./14-å¸–å­å‘å¸ƒåŠŸèƒ½å®ç°.md)**
